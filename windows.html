
            --bg: #f3f2f1;
            --bg-light: #faf9f8;
            --bg-dark: #edebe9;
            --border: #d2d0ce;
            --shadow: 0 2px 8px rgba(0,0,0,0.15);
            --taskbar-height: 40px;
            --window-header: 32px;
        }

        .dark-theme {
            --primary: #0086f0;
            --primary-dark: #0078d7;
            --accent: #10893e;
            --text: #ffffff;
            --text-light: #a19f9d;
            --bg: #1e1e1e;
            --bg-light: #2d2d30;
            --bg-dark: #252526;
            --border: #3e3e42;
            --shadow: 0 2px 8px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }



        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes bootProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Desktop */
        #desktop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - var(--taskbar-height));
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            backdrop-filter: blur(10px);
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 80px;
            gap: 20px;
            align-content: start;
        }

        .desktop-icon {
            width: 80px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            user-select: none;
            position: absolute;
        }

        .desktop-icon:hover {
            background: rgba(255,255,255,0.1);
        }

        .desktop-icon.selected {
            background: rgba(255,255,255,0.2);
        }

        .icon-image {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.9);
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 4px;
            font-size: 20px;
        }

        .icon-label {
            color: white;
            font-size: 12px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            padding: 2px 4px;
            border-radius: 2px;
            max-width: 76px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Context Menu */
        #context-menu {
            position: fixed;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            box-shadow: var(--shadow);
            z-index: 1000;
            min-width: 160px;
            display: none;
        }

        .context-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .context-item:hover {
            background: var(--primary);
            color: white;
        }

        .context-separator {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        /* Taskbar */
        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--taskbar-height);
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 8px;
            z-index: 1000;
        }

        .start-button {
            width: 40px;
            height: 32px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            margin-right: 8px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 14px;
        }

        .taskbar-apps {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .taskbar-app {
            padding: 4px 12px;
            margin: 0 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s;
        }

        .taskbar-app:hover {
            background: rgba(0,0,0,0.1);
        }

        .taskbar-app.active {
            background: rgba(0,0,0,0.15);
        }

        .taskbar-app-icon {
            width: 16px;
            height: 16px;
            background: var(--primary);
            border-radius: 2px;
            font-size: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .clock {
            padding: 4px 12px;
            font-size: 14px;
            color: var(--text-light);
        }

        /* Start Menu */
        #start-menu {
            position: fixed;
            bottom: var(--taskbar-height);
            left: 8px;
            width: 480px;
            height: 500px;
            background: var(--bg-light);
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: none;
            grid-template-columns: 200px 1fr;
            z-index: 999;
        }

        .start-left {
            background: var(--primary);
            color: white;
            border-radius: 8px 0 0 8px;
            padding: 20px;
        }

        .start-avatar {
            width: 64px;
            height: 64px;
            background: white;
            border-radius: 50%;
            margin-bottom: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary);
            font-weight: bold;
        }

        .start-quick-links {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .start-link {
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .start-link:hover {
            background: rgba(255,255,255,0.2);
        }

        .start-right {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .start-app {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .start-app:hover {
            background: var(--bg-dark);
        }

        .start-app-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 14px;
        }

        .start-app-label {
            font-size: 12px;
            text-align: center;
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: none;
            flex-direction: column;
            overflow: hidden;
            min-width: 400px;
            min-height: 300px;
        }

        .window.active {
            display: flex;
        }

        .window-header {
            height: var(--window-header);
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            cursor: move;
            user-select: none;
        }

        .window-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .window-icon {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: var(--primary);
        }

        .window-controls {
            display: flex;
            gap: 4px;
        }

        .window-control {
            width: 28px;
            height: 20px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }

        .window-control:hover {
            background: rgba(255,255,255,0.2);
        }

        .window-content {
            flex: 1;
            padding: 16px;
            overflow: auto;
        }

        /* Explorer */
        .explorer-content {
            display: flex;
            height: 100%;
        }

        .explorer-sidebar {
            width: 200px;
            border-right: 1px solid var(--border);
            padding: 8px;
        }

        .explorer-tree {
            list-style: none;
        }

        .explorer-tree-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .explorer-tree-item:hover {
            background: var(--bg-dark);
        }

        .explorer-tree-item.selected {
            background: var(--primary);
            color: white;
        }

        .explorer-files {
            flex: 1;
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 80px;
            gap: 12px;
            align-content: start;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: var(--bg-dark);
        }

        .file-icon {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            margin-bottom: 4px;
            font-size: 18px;
        }

        .file-name {
            font-size: 12px;
            text-align: center;
            max-width: 76px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Browser */
        .browser-tabs {
            display: flex;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border);
        }

        .browser-tab {
            padding: 8px 16px;
            background: var(--bg-dark);
            border-right: 1px solid var(--border);
            cursor: pointer;
            font-size: 14px;
        }

        .browser-tab.active {
            background: var(--bg-light);
        }

        .browser-address {
            display: flex;
            padding: 8px;
            gap: 8px;
            border-bottom: 1px solid var(--border);
        }

        .browser-url {
            flex: 1;
            padding: 4px 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }

        .browser-go {
            padding: 4px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .browser-content {
            padding: 16px;
            height: calc(100% - 80px);
            overflow: auto;
        }

        /* Notepad */
        .notepad-textarea {
            width: 100%;
            height: 100%;
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 8px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            resize: none;
            background: var(--bg);
            color: var(--text);
        }

        /* Settings */
        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg);
            border-radius: 4px;
        }

        .toggle {
            width: 44px;
            height: 24px;
            background: var(--border);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--primary);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .toggle.active::after {
            transform: translateX(20px);
        }

        /* Toast Notifications */
        #toast-container {
            position: fixed;
            bottom: 60px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            padding: 12px 16px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            box-shadow: var(--shadow);
            max-width: 300px;
            animation: toastIn 0.3s ease-out;
        }

        .toast.fade-out {
            animation: toastOut 0.3s ease-in forwards;
        }

        @keyframes toastIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes toastOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Resize Handle */
        .resize-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--primary);
            z-index: 10;
        }

        .resize-n { top: 0; left: 50%; transform: translateX(-50%); cursor: n-resize; }
        .resize-s { bottom: 0; left: 50%; transform: translateX(-50%); cursor: s-resize; }
        .resize-e { top: 50%; right: 0; transform: translateY(-50%); cursor: e-resize; }
        .resize-w { top: 50%; left: 0; transform: translateY(-50%); cursor: w-resize; }
        .resize-ne { top: 0; right: 0; cursor: ne-resize; }
        .resize-nw { top: 0; left: 0; cursor: nw-resize; }
        .resize-se { bottom: 0; right: 0; cursor: se-resize; }
        .resize-sw { bottom: 0; left: 0; cursor: sw-resize; }
    </style>
</head>
<body>
    <!-- Boot Screen -->
    <div id="boot-screen">
        <div class="boot-logo"></div>
        <div class="boot-progress">
            <div class="boot-progress-bar"></div>
        </div>
    </div>

    <!-- Desktop -->
    <div id="desktop"></div>

    <!-- Context Menu -->
    <div id="context-menu">
        <div class="context-item" data-action="refresh">Refresh</div>
        <div class="context-separator"></div>
        <div class="context-item" data-action="create-file">Create ‚Üí Text File</div>
    </div>

    <!-- Taskbar -->
    <div id="taskbar">
        <button class="start-button">„äÇ</button>
        <div class="taskbar-apps" id="taskbar-apps"></div>
        <div class="clock" id="clock"></div>
    </div>

    <!-- Start Menu -->
    <div id="start-menu">
        <div class="start-left">
            <div class="start-avatar">AI</div>
            <div class="start-quick-links">
                <div class="start-link" data-app="explorer">Documents</div>
                <div class="start-link" data-app="settings">Settings</div>
            </div>
        </div>
        <div class="start-right">
            <div class="start-app" data-app="explorer">
                <div class="start-app-icon">üìÅ</div>
                <div class="start-app-label">Explorer</div>
            </div>
            <div class="start-app" data-app="browser">
                <div class="start-app-icon">üåê</div>
                <div class="start-app-label">Browser</div>
            </div>
            <div class="start-app" data-app="notepad">
                <div class="start-app-icon">üìù</div>
                <div class="start-app-label">Notepad</div>
            </div>
        </div>
    </div>

    <!-- Windows Container -->
    <div id="windows-container"></div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Audio for startup 
            desktopManager: {
                icons: [],
                selectedIcon: null,

                init() {
                    this.createDesktopIcons();
                    this.setupEventListeners();
                    this.loadIconPositions();
                },

                createDesktopIcons() {
                    const desktop = document.getElementById('desktop');
                    const apps = [
                        { id: 'explorer', name: 'Explorer', icon: 'üìÅ' },
                        { id: 'browser', name: 'Browser', icon: 'üåê' },
                        { id: 'notepad', name: 'Notepad', icon: 'üìù' },
                        { id: 'settings', name: 'Settings', icon: '‚öôÔ∏è' },
                        { id: 'recycle', name: 'Recycle Bin', icon: 'üóëÔ∏è' }
                    ];

                    apps.forEach((app, index) => {
                        const icon = document.createElement('div');
                        icon.className = 'desktop-icon';
                        icon.innerHTML = `
                            <div class="icon-image">${app.icon}</div>
                            <div class="icon-label">${app.name}</div>
                        `;
                        icon.style.left = `${20 + (index % 3) * 100}px`;
                        icon.style.top = `${20 + Math.floor(index / 3) * 100}px`;
                        icon.dataset.app = app.id;

                        desktop.appendChild(icon);
                        this.icons.push(icon);
                    });
                },

                setupEventListeners() {
                    document.addEventListener('contextmenu', (e) => {
                        if (e.target.closest('#desktop')) {
                            e.preventDefault();
                            this.showContextMenu(e.clientX, e.clientY);
                        }
                    });

                    document.addEventListener('click', () => {
                        this.hideContextMenu();
                        this.deselectAllIcons();
                    });

                    this.icons.forEach(icon => {
                        icon.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.selectIcon(icon);
                        });

                        icon.addEventListener('dblclick', () => {
                            const appId = icon.dataset.app;
                            if (appId !== 'recycle') {
                                AIWindowsLight.appManager.openApp(appId);
                            }
                        });

                        this.makeDraggable(icon);
                    });
                },

                showContextMenu(x, y) {
                    const menu = document.getElementById('context-menu');
                    menu.style.display = 'block';
                    menu.style.left = `${x}px`;
                    menu.style.top = `${y}px`;

                    menu.querySelectorAll('.context-item').forEach(item => {
                        item.onclick = () => this.handleContextAction(item.dataset.action);
                    });
                },

                hideContextMenu() {
                    document.getElementById('context-menu').style.display = 'none';
                },

                handleContextAction(action) {
                    this.hideContextMenu();
                    switch (action) {
                        case 'refresh':
                            AIWindowsLight.showToast('Desktop refreshed');
                            break;
                        case 'create-file':
                            AIWindowsLight.fileSystem.createFile('New Text File.txt', '');
                            AIWindowsLight.showToast('File created');
                            break;
                    }
                },

                selectIcon(icon) {
                    this.deselectAllIcons();
                    icon.classList.add('selected');
                    this.selectedIcon = icon;
                },

                deselectAllIcons() {
                    this.icons.forEach(icon => icon.classList.remove('selected'));
                    this.selectedIcon = null;
                },

                makeDraggable(element) {
                    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                    
                    element.onmousedown = dragMouseDown;

                    function dragMouseDown(e) {
                        e.preventDefault();
                        pos3 = e.clientX;
                        pos4 = e.clientY;
                        document.onmouseup = closeDragElement;
                        document.onmousemove = elementDrag;
                    }

                    function elementDrag(e) {
                        e.preventDefault();
                        pos1 = pos3 - e.clientX;
                        pos2 = pos4 - e.clientY;
                        pos3 = e.clientX;
                        pos4 = e.clientY;
                        
                        element.style.top = (element.offsetTop - pos2) + "px";
                        element.style.left = (element.offsetLeft - pos1) + "px";
                    }

                    function closeDragElement() {
                        document.onmouseup = null;
                        document.onmousemove = null;
                        AIWindowsLight.desktopManager.saveIconPositions();
                    }
                },

                saveIconPositions() {
                    const positions = this.icons.map(icon => ({
                        app: icon.dataset.app,
                        left: icon.style.left,
                        top: icon.style.top
                    }));
                    localStorage.setItem('desktopIconPositions', JSON.stringify(positions));
                },

                loadIconPositions() {
                    try {
                        const positions = JSON.parse(localStorage.getItem('desktopIconPositions') || '[]');
                        positions.forEach(pos => {
                            const icon = this.icons.find(i => i.dataset.app === pos.app);
                            if (icon) {
                                icon.style.left = pos.left;
                                icon.style.top = pos.top;
                            }
                        });
                    } catch (e) {
                        console.warn('Failed to load icon positions');
                    }
                }
            },

            windowManager: {
                windows: [],
                zIndex: 100,
                activeWindow: null,

                init() {
                    this.setupEventListeners();
                },

                createWindow(appId, title, icon, content) {
                    const windowId = `window-${Date.now()}`;
                    const windowEl = document.createElement('div');
                    windowEl.className = 'window';
                    windowEl.id = windowId;
                    windowEl.innerHTML = `
                        <div class="window-header">
                            <div class="window-title">
                                <div class="window-icon">${icon}</div>
                                <span>${title}</span>
                            </div>
                            <div class="window-controls">
                                <button class="window-control" data-action="minimize">‚àí</button>
                                <button class="window-control" data-action="maximize">‚ñ°</button>
                                <button class="window-control" data-action="close">√ó</button>
                            </div>
                        </div>
                        <div class="window-content">${content}</div>
                        <div class="resize-handle resize-n"></div>
                        <div class="resize-handle resize-s"></div>
                        <div class="resize-handle resize-e"></div>
                        <div class="resize-handle resize-w"></div>
                        <div class="resize-handle resize-ne"></div>
                        <div class="resize-handle resize-nw"></div>
                        <div class="resize-handle resize-se"></div>
                        <div class="resize-handle resize-sw"></div>
                    `;

                    document.getElementById('windows-container').appendChild(windowEl);
                    
                    const windowObj = {
                        id: windowId,
                        element: windowEl,
                        appId: appId,
                        minimized: false,
                        maximized: false,
                        originalSize: { width: '600px', height: '400px' },
                        originalPosition: { left: '100px', top: '100px' }
                    };

                    this.windows.push(windowObj);
                    this.bringToFront(windowObj);
                    this.setupWindowEvents(windowObj);
                    
                    // Animation
                    windowEl.style.transform = 'scale(0.8)';
                    windowEl.style.opacity = '0';
                    setTimeout(() => {
                        windowEl.style.transition = 'all 0.2s ease-out';
                        windowEl.style.transform = 'scale(1)';
                        windowEl.style.opacity = '1';
                    }, 10);

                    return windowObj;
                },

                setupWindowEvents(windowObj) {
                    const el = windowObj.element;
                    const header = el.querySelector('.window-header');
                    const controls = el.querySelectorAll('.window-control');
                    const resizeHandles = el.querySelectorAll('.resize-handle');

                    // Focus window
                    el.addEventListener('mousedown', () => {
                        this.bringToFront(windowObj);
                    });

                    // Window controls
                    controls.forEach(control => {
                        control.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const action = control.dataset.action;
                            this.handleWindowControl(windowObj, action);
                        });
                    });

                    // Drag window
                    this.makeWindowDraggable(header, el, windowObj);

                    // Resize window
                    resizeHandles.forEach(handle => {
                        this.makeWindowResizable(handle, el, windowObj);
                    });
                },

                handleWindowControl(windowObj, action) {
                    switch (action) {
                        case 'minimize':
                            this.minimizeWindow(windowObj);
                            break;
                        case 'maximize':
                            this.toggleMaximize(windowObj);
                            break;
                        case 'close':
                            this.closeWindow(windowObj);
                            break;
                    }
                },

                minimizeWindow(windowObj) {
                    windowObj.element.style.display = 'none';
                    windowObj.minimized = true;
                    AIWindowsLight.appManager.updateTaskbar();
                },

                toggleMaximize(windowObj) {
                    if (windowObj.maximized) {
                        this.restoreWindow(windowObj);
                    } else {
                        this.maximizeWindow(windowObj);
                    }
                },

                maximizeWindow(windowObj) {
                    windowObj.originalSize = {
                        width: windowObj.element.style.width,
                        height: windowObj.element.style.height
                    };
                    windowObj.originalPosition = {
                        left: windowObj.element.style.left,
                        top: windowObj.element.style.top
                    };
                    
                    windowObj.element.style.width = '100%';
                    windowObj.element.style.height = 'calc(100% - var(--taskbar-height))';
                    windowObj.element.style.left = '0';
                    windowObj.element.style.top = '0';
                    windowObj.maximized = true;
                },

                restoreWindow(windowObj) {
                    windowObj.element.style.width = windowObj.originalSize.width;
                    windowObj.element.style.height = windowObj.originalSize.height;
                    windowObj.element.style.left = windowObj.originalPosition.left;
                    windowObj.element.style.top = windowObj.originalPosition.top;
                    windowObj.maximized = false;
                },

                closeWindow(windowObj) {
                    windowObj.element.style.transition = 'all 0.2s ease-in';
                    windowObj.element.style.transform = 'scale(0.8)';
                    windowObj.element.style.opacity = '0';
                    
                    setTimeout(() => {
                        windowObj.element.remove();
                        this.windows = this.windows.filter(w => w.id !== windowObj.id);
                        AIWindowsLight.appManager.updateTaskbar();
                    }, 200);
                },

                bringToFront(windowObj) {
                    this.zIndex++;
                    windowObj.element.style.zIndex = this.zIndex;
                    this.activeWindow = windowObj;
                    
                    // Update taskbar
                    this.windows.forEach(w => {
                        const taskbarApp = document.querySelector(`[data-window="${w.id}"]`);
                        if (taskbarApp) {
                            taskbarApp.classList.toggle('active', w === windowObj);
                        }
                    });
                },

                makeWindowDraggable(header, windowEl, windowObj) {
                    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                    
                    header.onmousedown = dragMouseDown;

                    function dragMouseDown(e) {
                        if (windowObj.maximized) return;
                        e.preventDefault();
                        pos3 = e.clientX;
                        pos4 = e.clientY;
                        document.onmouseup = closeDragElement;
                        document.onmousemove = elementDrag;
                    }

                    function elementDrag(e) {
                        e.preventDefault();
                        pos1 = pos3 - e.clientX;
                        pos2 = pos4 - e.clientY;
                        pos3 = e.clientX;
                        pos4 = e.clientY;
                        
                        windowEl.style.top = (windowEl.offsetTop - pos2) + "px";
                        windowEl.style.left = (windowEl.offsetLeft - pos1) + "px";
                    }

                    function closeDragElement() {
                        document.onmouseup = null;
                        document.onmousemove = null;
                    }
                },

                makeWindowResizable(handle, windowEl, windowObj) {
                    handle.addEventListener('mousedown', initResize);

                    function initResize(e) {
                        e.preventDefault();
                        const startX = e.clientX;
                        const startY = e.clientY;
                        const startWidth = parseInt(document.defaultView.getComputedStyle(windowEl).width, 10);
                        const startHeight = parseInt(document.defaultView.getComputedStyle(windowEl).height, 10);
                        const startLeft = windowEl.offsetLeft;
                        const startTop = windowEl.offsetTop;

                        function doResize(e) {
                            if (handle.classList.contains('resize-e') || handle.classList.contains('resize-ne') || handle.classList.contains('resize-se')) {
                                windowEl.style.width = (startWidth + e.clientX - startX) + 'px';
                            }
                            if (handle.classList.contains('resize-s') || handle.classList.contains('resize-se') || handle.classList.contains('resize-sw')) {
                                windowEl.style.height = (startHeight + e.clientY - startY) + 'px';
                            }
                            if (handle.classList.contains('resize-w') || handle.classList.contains('resize-nw') || handle.classList.contains('resize-sw')) {
                                windowEl.style.width = (startWidth - e.clientX + startX) + 'px';
                                windowEl.style.left = (startLeft + e.clientX - startX) + 'px';
                            }
                            if (handle.classList.contains('resize-n') || handle.classList.contains('resize-ne') || handle.classList.contains('resize-nw')) {
                                windowEl.style.height = (startHeight - e.clientY + startY) + 'px';
                                windowEl.style.top = (startTop + e.clientY - startY) + 'px';
                            }
                        }

                        function stopResize() {
                            document.documentElement.removeEventListener('mousemove', doResize, false);
                            document.documentElement.removeEventListener('mouseup', stopResize, false);
                        }

                        document.documentElement.addEventListener('mousemove', doResize, false);
                        document.documentElement.addEventListener('mouseup', stopResize, false);
                    }
                },

                getWindowByAppId(appId) {
                    return this.windows.find(w => w.appId === appId && !w.minimized);
                }
            },

            appManager: {
                apps: {
                    explorer: {
                        name: 'File Explorer',
                        icon: 'üìÅ',
                        content: `
                            <div class="explorer-content">
                                <div class="explorer-sidebar">
                                    <div class="explorer-tree">
                                        <div class="explorer-tree-item selected">üìÅ C:/</div>
                                        <div class="explorer-tree-item">üìÅ Users/AI_User</div>
                                        <div class="explorer-tree-item">üìÅ Documents</div>
                                        <div class="explorer-tree-item">üìÅ Pictures</div>
                                    </div>
                                </div>
                                <div class="explorer-files" id="explorer-files"></div>
                            </div>
                        `
                    },
                    browser: {
                        name: 'Web Browser',
                        icon: 'üåê',
                        content: `
                            <div class="browser-tabs">
                                <div class="browser-tab active">Home</div>
                                <div class="browser-tab">Search</div>
                                <div class="browser-tab">News</div>
                            </div>
                            <div class="browser-address">
                                <input type="text" class="browser-url" value="https://homepage.ai">
                                <button class="browser-go">Go</button>
                            </div>
                            <div class="browser-content" id="browser-content">
                                <h2>Welcome to AI Browser</h2>
                                <p>This is a lightweight browser for your AI Windows experience.</p>
                            </div>
                        `
                    },
                    notepad: {
                        name: 'Notepad',
                        icon: 'üìù',
                        content: `
                            <textarea class="notepad-textarea" id="notepad-content" placeholder="Start typing..."></textarea>
                        `
                    },
                    settings: {
                        name: 'Settings',
                        icon: '‚öôÔ∏è',
                        content: `
                            <div class="settings-content">
                                <div class="setting-item">
                                    <span>Dark Theme</span>
                                    <div class="toggle" id="theme-toggle"></div>
                                </div>
                                <div class="setting-item">
                                    <span>Sound Effects</span>
                                    <div class="toggle active" id="sound-toggle"></div>
                                </div>
                            </div>
                        `
                    }
                },

                init() {
                    this.setupAppEvents();
                    this.updateTaskbar();
                },

                openApp(appId) {
                    // Check if app is already open
                    const existingWindow = AIWindowsLight.windowManager.getWindowByAppId(appId);
                    if (existingWindow) {
                        AIWindowsLight.windowManager.bringToFront(existingWindow);
                        if (existingWindow.minimized) {
                            existingWindow.element.style.display = 'flex';
                            existingWindow.minimized = false;
                            this.updateTaskbar();
                        }
                        return;
                    }

                    const app = this.apps[appId];
                    if (!app) return;

                    const windowObj = AIWindowsLight.windowManager.createWindow(
                        appId,
                        app.name,
                        app.icon,
                        app.content
                    );

                    // App-specific initialization
                    this.initAppContent(appId, windowObj);

                    this.updateTaskbar();
                    return windowObj;
                },

                initAppContent(appId, windowObj) {
                    switch (appId) {
                        case 'explorer':
                            this.initExplorer(windowObj);
                            break;
                        case 'browser':
                            this.initBrowser(windowObj);
                            break;
                        case 'notepad':
                            this.initNotepad(windowObj);
                            break;
                        case 'settings':
                            this.initSettings(windowObj);
                            break;
                    }
                },

                initExplorer(windowObj) {
                    const filesContainer = windowObj.element.querySelector('#explorer-files');
                    this.updateFileList(filesContainer);
                },

                initBrowser(windowObj) {
                    const tabs = windowObj.element.querySelectorAll('.browser-tab');
                    const content = windowObj.element.querySelector('#browser-content');
                    
                    tabs.forEach(tab => {
                        tab.addEventListener('click', () => {
                            tabs.forEach(t => t.classList.remove('active'));
                            tab.classList.add('active');
                            
                            const tabName = tab.textContent.toLowerCase();
                            this.showBrowserTab(tabName, content);
                        });
                    });
                    
                    // Initial tab
                    this.showBrowserTab('home', content);
                },

                showBrowserTab(tabName, content) {
                    let html = '';
                    switch (tabName) {
                        case 'home':
                            html = `
                                <h2>Welcome to AI Browser</h2>
                                <p>This is a lightweight browser for your AI Windows experience.</p>
                                <ul>
                                    <li>Fast and secure browsing</li>
                                    <li>Built-in search functionality</li>
                                    <li>Local news feed</li>
                                </ul>
                            `;
                            break;
                        case 'search':
                            html = `
                                <h2>Search Results</h2>
                                <p>Results for "AI Windows":</p>
                                <div style="margin-top: 16px;">
                                    <div style="padding: 8px; border-bottom: 1px solid var(--border);">
                                        <strong>AI Windows Light - Official Site</strong>
                                        <p>https://ai-windows-light.demo</p>
                                    </div>
                                    <div style="padding: 8px; border-bottom: 1px solid var(--border);">
                                        <strong>Getting Started with AI Windows</strong>
                                        <p>https://docs.ai-windows.demo</p>
                                    </div>
                                </div>
                            `;
                            break;
                        case 'news':
                            html = `
                                <h2>Latest News</h2>
                                <div style="margin-top: 16px;">
                                    <div style="padding: 8px; border-bottom: 1px solid var(--border);">
                                        <strong>AI Windows Light Released</strong>
                                        <p>New lightweight version now available with improved performance.</p>
                                    </div>
                                    <div style="padding: 8px; border-bottom: 1px solid var(--border);">
                                        <strong>Update: Enhanced Security Features</strong>
                                        <p>Latest update includes new security enhancements.</p>
                                    </div>
                                </div>
                            `;
                            break;
                    }
                    content.innerHTML = html;
                },

                initNotepad(windowObj) {
                    const textarea = windowObj.element.querySelector('#notepad-content');
                    const saved = localStorage.getItem('notepad-content');
                    if (saved) textarea.value = saved;
                    
                    textarea.addEventListener('input', () => {
                        localStorage.setItem('notepad-content', textarea.value);
                    });
                },

                initSettings(windowObj) {
                    const themeToggle = windowObj.element.querySelector('#theme-toggle');
                    const soundToggle = windowObj.element.querySelector('#sound-toggle');
                    
                    // Load saved settings
                    const isDark = localStorage.getItem('theme') === 'dark';
                    const soundEnabled = localStorage.getItem('sound') !== 'false';
                    
                    if (isDark) themeToggle.classList.add('active');
                    if (soundEnabled) soundToggle.classList.add('active');
                    
                    themeToggle.addEventListener('click', () => {
                        themeToggle.classList.toggle('active');
                        AIWindowsLight.settingsManager.toggleTheme();
                    });
                    
                    soundToggle.addEventListener('click', () => {
                        soundToggle.classList.toggle('active');
                        AIWindowsLight.settingsManager.toggleSound();
                    });
                },

                updateFileList(container) {
                    const files = AIWindowsLight.fileSystem.getFiles();
                    container.innerHTML = '';
                    
                    files.forEach(file => {
                        const fileEl = document.createElement('div');
                        fileEl.className = 'file-item';
                        fileEl.innerHTML = `
                            <div class="file-icon">${file.type === 'folder' ? 'üìÅ' : 'üìÑ'}</div>
                            <div class="file-name">${file.name}</div>
                        `;
                        
                        if (file.type === 'file') {
                            fileEl.addEventListener('dblclick', () => {
                                AIWindowsLight.appManager.openApp('notepad');
                                AIWindowsLight.showToast(`Opening ${file.name}`);
                            });
                        }
                        
                        container.appendChild(fileEl);
                    });
                },

                updateTaskbar() {
                    const container = document.getElementById('taskbar-apps');
                    container.innerHTML = '';
                    
                    AIWindowsLight.windowManager.windows.forEach(windowObj => {
                        if (!windowObj.minimized) {
                            const app = this.apps[windowObj.appId];
                            if (app) {
                                const taskbarApp = document.createElement('div');
                                taskbarApp.className = `taskbar-app ${windowObj === AIWindowsLight.windowManager.activeWindow ? 'active' : ''}`;
                                taskbarApp.innerHTML = `
                                    <div class="taskbar-app-icon">${app.icon}</div>
                                    ${app.name}
                                `;
                                taskbarApp.dataset.window = windowObj.id;
                                
                                taskbarApp.addEventListener('click', () => {
                                    if (windowObj.minimized) {
                                        windowObj.element.style.display = 'flex';
                                        windowObj.minimized = false;
                                    }
                                    AIWindowsLight.windowManager.bringToFront(windowObj);
                                });
                                
                                container.appendChild(taskbarApp);
                            }
                        }
                    });
                },

                setupAppEvents() {
                    // Start menu
                    document.querySelector('.start-button').addEventListener('click', () => {
                        const menu = document.getElementById('start-menu');
                        menu.style.display = menu.style.display === 'grid' ? 'none' : 'grid';
                    });

                    // Start menu apps
                    document.querySelectorAll('.start-app, .start-link').forEach(item => {
                        item.addEventListener('click', () => {
                            const appId = item.dataset.app;
                            if (appId) {
                                this.openApp(appId);
                                document.getElementById('start-menu').style.display = 'none';
                            }
                        });
                    });

                    // Close start menu when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!e.target.closest('#start-menu') && !e.target.closest('.start-button')) {
                            document.getElementById('start-menu').style.display = 'none';
                        }
                    });
                }
            },

            fileSystem: {
                files: [
                    { name: 'Documents', type: 'folder' },
                    { name: 'Pictures', type: 'folder' },
                    { name: 'readme.txt', type: 'file' },
                    { name: 'notes.txt', type: 'file' }
                ],

                init() {
                    this.loadFromStorage();
                },

                getFiles() {
                    return this.files;
                },

                createFile(name, content) {
                    this.files.push({ name, type: 'file', content });
                    this.saveToStorage();
                },

                deleteFile(name) {
                    this.files = this.files.filter(file => file.name !== name);
                    this.saveToStorage();
                },

                loadFromStorage() {
                    try {
                        const saved = localStorage.getItem('fileSystem');
                        if (saved) {
                            this.files = JSON.parse(saved);
                        }
                    } catch (e) {
                        console.warn('Failed to load file system');
                    }
                },

                saveToStorage() {
                    try {
                        localStorage.setItem('fileSystem', JSON.stringify(this.files));
                    } catch (e) {
                        console.warn('Failed to save file system');
                    }
                }
            },

            settingsManager: {
                init() {
                    this.loadSettings();
                },

                toggleTheme() {
                    const isDark = document.body.classList.toggle('dark-theme');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                },

                toggleSound() {
                    const enabled = localStorage.getItem('sound') !== 'false';
                    localStorage.setItem('sound', !enabled);
                    AIWindowsLight.showToast(`Sound ${!enabled ? 'enabled' : 'disabled'}`);
                },

                loadSettings() {
                    const theme = localStorage.getItem('theme');
                    if (theme === 'dark') {
                        document.body.classList.add('dark-theme');
                    }
                }
            },

            eventManager: {
                init() {
                    this.setupHotkeys();
                    this.setupClock();
                },

                setupHotkeys() {
                    document.addEventListener('keydown', (e) => {
                        // Win+D - Show desktop
                        if (e.key === 'd' && (e.metaKey || e.ctrlKey)) {
                            e.preventDefault();
                            this.toggleDesktop();
                        }
                        
                        // Win+E - Open Explorer
                        if (e.key === 'e' && (e.metaKey || e.ctrlKey)) {
                            e.preventDefault();
                            AIWindowsLight.appManager.openApp('explorer');
                        }
                        
                        // Alt+F4 - Close active window
                        if (e.key === 'F4' && e.altKey) {
                            e.preventDefault();
                            if (AIWindowsLight.windowManager.activeWindow) {
                                AIWindowsLight.windowManager.closeWindow(AIWindowsLight.windowManager.activeWindow);
                            }
                        }
                        
                        // Ctrl+S - Save in Notepad
                        if (e.key === 's' && e.ctrlKey) {
                            e.preventDefault();
                            this.saveNotepad();
                        }
                    });
                },

                toggleDesktop() {
                    const windows = document.querySelectorAll('.window');
                    const allHidden = Array.from(windows).every(w => w.style.display === 'none');
                    
                    windows.forEach(window => {
                        window.style.display = allHidden ? 'flex' : 'none';
                    });
                    
                    AIWindowsLight.showToast(allHidden ? 'Showing windows' : 'Showing desktop');
                },

                saveNotepad() {
                    const notepadWindow = AIWindowsLight.windowManager.getWindowByAppId('notepad');
                    if (notepadWindow) {
                        const content = notepadWindow.element.querySelector('#notepad-content').value;
                        const blob = new Blob([content], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'document.txt';
                        a.click();
                        URL.revokeObjectURL(url);
                        AIWindowsLight.showToast('Document saved');
                    }
                },

                setupClock() {
                    function updateClock() {
                        const now = new Date();
                        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        document.getElementById('clock').textContent = timeString;
                    }
                    
                    updateClock();
                    setInterval(updateClock, 1000);
                }
            },

            showToast(message, duration = 3000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('fade-out');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, duration);
            }
        };

        // Error handling
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            AIWindowsLight.showToast('An error occurred: ' + msg);
            return false;
        };

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            AIWindowsLight.init();
        });
    </script>
</body>
</html>