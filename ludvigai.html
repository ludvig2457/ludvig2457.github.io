<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LudvigAI - Многофункциональный AI-чат</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Font Awesome CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<style>
/* Анимации и стили */
@keyframes gradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}
body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
}
</style>
</head>
<body class="bg-gray-900 text-gray-100 transition-colors duration-300">

<!-- Header -->
<header class="fixed top-0 inset-x-0 flex justify-between items-center px-4 py-2 bg-gray-800 z-50 shadow-lg">
  <div class="flex items-center space-x-3 cursor-pointer" id="profileButton">
    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center text-white font-bold" id="profileInitial">Г</div>
    <div>
      <div class="font-semibold" id="profileName">Гость</div>
      <div class="text-sm text-gray-400" id="profileRole">Неавторизован</div>
    </div>
  </div>
  <div class="flex items-center space-x-4">
    <button id="settingsButton" class="p-2 rounded-full hover:bg-gray-700"><i class="fas fa-cog"></i></button>
    <button id="themeSwitch" class="p-2 rounded-full hover:bg-gray-700"><i class="fas fa-moon"></i></button>
    <button id="logoutButton" class="p-2 rounded-full hover:bg-gray-700" title="Выйти"><i class="fas fa-sign-out-alt"></i></button>
  </div>
</header>

<!-- Sidebar -->
<div class="fixed top-0 left-0 h-full w-64 bg-gray-800 flex flex-col z-40 transition-transform transform" id="sidebar">
  <div class="p-4 border-b border-gray-700 flex items-center justify-between">
    <div class="flex items-center space-x-2 cursor-pointer" id="newChatBtn">
      <div class="p-2 bg-purple-600 rounded-full"><i class="fas fa-plus text-white"></i></div>
      <div class="font-semibold">Создать чат</div>
    </div>
    <button id="sidebarToggle" class="p-2 rounded-full hover:bg-gray-700"><i class="fas fa-bars"></i></button>
  </div>
  <div class="flex-1 overflow-y-auto" id="chatListContainer">
    <!-- Сюда добавим список чатов -->
  </div>
  <div class="p-4 border-t border-gray-700">
    <button id="createChatBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded">Добавить чат</button>
  </div>
</div>

<!-- Main -->
<main class="ml-64 flex flex-col h-full pt-16">
  <!-- Chat header -->
  <div class="px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between sticky top-0 z-20">
    <h1 class="text-xl font-bold" id="currentChatTitle">Общий чат</h1>
    <button id="profileSettingsBtn" class="p-2 rounded-full hover:bg-gray-700"><i class="fas fa-user-cog"></i></button>
  </div>
  <!-- Messages -->
  <div id="messagesContainer" class="flex-1 p-4 overflow-y-auto space-y-4" style="background:#1e1e2f;">
    <!-- Сообщения появятся сюда -->
  </div>
  <!-- Input -->
  <div class="px-4 py-3 bg-gray-800 border-t border-gray-700 sticky bottom-0 z-20">
    <div class="relative max-w-3xl mx-auto flex items-center">
      <textarea id="messageInput" class="w-full resize-none rounded-full px-4 py-2 bg-gray-900 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" rows="1" placeholder="Напишите сообщение..."></textarea>
      <button id="sendBtn" class="absolute right-2 bottom-2 p-2 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full hover:bg-purple-700"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</main>

<!-- Модальные окна -->
<div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4 relative">
    <h2 class="text-xl font-semibold mb-4">Профиль</h2>
    <div class="flex items-center space-x-4 mb-4">
      <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold" id="modalProfileInitial">Г</div>
      <div>
        <div class="font-semibold" id="modalProfileName">Гость</div>
        <div class="text-sm text-gray-500" id="modalProfileRole">Неавторизован</div>
      </div>
    </div>
    <button id="closeProfileBtn" class="mt-4 bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">Закрыть</button>
  </div>
</div>

<div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4 relative">
    <h2 class="text-xl font-semibold mb-4">Настройки</h2>
    <!-- Настройки темы -->
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Тема</h3>
      <div class="flex space-x-2">
        <button class="theme-btn px-3 py-1 border rounded" data-theme="light">Светлая</button>
        <button class="theme-btn px-3 py-1 border rounded" data-theme="dark">Темная</button>
        <button class="theme-btn px-3 py-1 border rounded" data-theme="auto">Авто</button>
      </div>
    </div>
    <!-- Язык -->
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Язык</h3>
      <select class="w-full border rounded px-3 py-2" id="languageSelect">
        <option>Русский</option>
        <option>English</option>
        <option>Español</option>
      </select>
    </div>
    <!-- Уведомления -->
    <div class="mb-4">
      <h3 class="font-semibold mb-2">Уведомления</h3>
      <label class="flex items-center space-x-2">
        <input type="checkbox" checked id="pushNotifications">
        <span>Push-уведомления</span>
      </label>
    </div>
    <!-- Выйти -->
    <button id="logoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded mt-4">Выйти</button>
    <button id="closeSettingsBtn" class="mt-4 bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">Закрыть</button>
  </div>
</div>

<!-- Скрипт -->
<script>
// =================== Переменные ====================
let currentUser = { name: 'Гость', role: 'Неавторизован', isAuth: false };
let chats = []; // все чаты
let activeChatId = null;
const responseTemplates = {
  'привет': ['Привет! Чем могу помочь?', 'Здравствуйте! Что интересует?'],
  'как': ['У меня всё отлично!', 'Работаю как обычно.'],
  'помоги': ['Конечно! Расскажи подробнее.', 'Я тут, чтобы помочь!'],
  'код': ['Могу помочь с кодом. Что нужно?', 'Расскажи, какой язык программирования?'],
  'пока': ['До свидания!', 'Обращайтесь еще!']
};
const defaultResponses = ['Интересно! Расскажи подробнее.', 'Я слушаю вас.'];

// =================== Функции ====================

// Инициализация
function init() {
  loadChats();
  if (localStorage.getItem('chats')) {
    chats = JSON.parse(localStorage.getItem('chats'));
  } else {
    createChat('Общий чат');
  }
  selectChat(chats[0].id);
  updateProfileDisplay();
  applyTheme('auto');
}

// Создать чат
function createChat(title='Новый чат') {
  const id = Date.now();
  const dateStr = new Date().toLocaleString('ru-RU', { year: 'numeric', month: 'short', day: 'numeric' });
  chats.push({ id, title, date: dateStr, messages: [{ sender: 'bot', text: 'Здравствуйте! Чем могу помочь?' }] });
  saveChats();
}

// Сохранить
function saveChats() {
  localStorage.setItem('chats', JSON.stringify(chats));
}

// Загрузить список чатов
function loadChats() {
  const container = document.getElementById('chatList');
  container.innerHTML = '';
  chats.forEach(c => {
    const btn = document.createElement('button');
    btn.className='w-full px-3 py-2 text-left hover:bg-gray-700 rounded';
    btn.dataset.id=c.id;
    btn.innerHTML = `<strong>${c.title}</strong><br/><small class="text-gray-400">${c.date}</small>`;
    btn.onclick=()=>{selectChat(c.id);};
    container.appendChild(btn);
  });
}

// Выбрать чат
function selectChat(id) {
  activeChatId = id;
  document.querySelectorAll('#chatList button').forEach(b=>b.classList.remove('bg-gray-700'));
  const btn = document.querySelector(`#chatList button[data-id="${id}"]`);
  if (btn) btn.classList.add('bg-gray-700');

  // показать сообщения
  const chat = chats.find(c=>c.id===id);
  const container = document.getElementById('messagesContainer');
  container.innerHTML='';
  chat.messages.forEach(m => {appendMsg(m.text, m.sender==='user');});
  document.getElementById('currentChatTitle').textContent=chat.title;
  scrollBottom();
}

// Создать сообщение
function appendMsg(text, isUser) {
  const container=document.getElementById('messagesContainer');
  const msgDiv=document.createElement('div');
  msgDiv.className='flex '+(isUser?'justify-end':'justify-start')+' space-x-2';
  const bubble=document.createElement('div');
  bubble.className='px-4 py-2 rounded-lg max-w-xs '+(isUser?'bg-blue-600 text-white':'bg-gray-200 dark:bg-gray-700');
  bubble.innerHTML=formatMsg(text);
  msgDiv.appendChild(bubble);
  container.appendChild(msgDiv);
  scrollBottom();
}

// Форматировать сообщение
function formatMsg(text) {
  return text.replace(/\n/g,'<br/>');
}

// Отправить сообщение
function sendMessage() {
  const input=document.getElementById('messageInput');
  const text=input.value.trim();
  if (!text || !activeChatId) return;
  // добавляем себе
  addMsgToChat(text,'user');
  appendMsg(text,true);
  input.value='';
  document.getElementById('sendBtn').disabled=true;
  showTyping();
  setTimeout(()=> {
    hideTyping();
    const reply=getAIResponse(text);
    addMsgToChat(reply,'bot');
    appendMsg(reply,false);
  },1500+Math.random()*1000);
}

// Добавить сообщение в чат
function addMsgToChat(text,sender) {
  const chat=chats.find(c=>c.id===activeChatId);
  if (!chat) return;
  chat.messages.push({sender,text});
  saveChats();
}

// Получить ответ ИИ
function getAIResponse(input) {
  input=input.toLowerCase();
  for (let key in responseTemplates) {
    if (input.includes(key)) {
      const responses=responseTemplates[key];
      return responses[Math.floor(Math.random()*responses.length)];
    }
  }
  return defaultResponses[Math.floor(Math.random()*defaultResponses.length)];
}

// Обновление профиля
function updateProfileDisplay() {
  document.getElementById('profileName').textContent=currentUser.name;
  document.getElementById('profileInitial').textContent=currentUser.name.charAt(0).toUpperCase();
  document.getElementById('profileRole').textContent=currentUser.role;
}

// Переключение темы
function applyTheme(theme) {
  if (theme==='dark' || (theme==='auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
    localStorage.setItem('theme','auto');
  } else {
    document.documentElement.classList.remove('dark');
    localStorage.setItem('theme','light');
  }
}
const savedTheme=localStorage.getItem('theme')||'auto';
applyTheme(savedTheme);

// =================== Обработчики ====================
document.getElementById('sendBtn').onclick=()=>sendMessage();
document.getElementById('messageInput').addEventListener('input', ()=> {
  document.getElementById('sendBtn').disabled=!document.getElementById('messageInput').value.trim();
});
document.getElementById('messageInput').addEventListener('keypress', e => {
  if (e.key==='Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});
document.getElementById('createChatBtn').onclick=()=> {
  const title=prompt('Введите название чата', 'Чат '+(chats.length+1));
  if (title) { createChat(title); loadChats(); selectChat(chats[chats.length-1].id); }
};
document.getElementById('newChatBtn')?.addEventListener('click', ()=> {
  const title='Новый чат '+(chats.length+1);
  createChat(title);
  loadChats();
  selectChat(chats[chats.length-1].id);
});

// Вкладки
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.onclick=()=> {
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('border-b-2','border-purple-600','text-purple-600'));
    btn.classList.add('border-b-2','border-purple-600','text-purple-600');
    const tab=btn.dataset.tab;
    document.querySelectorAll('#chatTab,#searchTab').forEach(c=>c.classList.add('hidden'));
    if (tab==='chat') document.getElementById('chatTab').classList.remove('hidden');
    else document.getElementById('searchTab').classList.remove('hidden');
  };
});

// Авторизация
document.getElementById('profileButton').onclick=()=> {
  document.querySelector('#profileModal').classList.remove('hidden');
};
document.getElementById('closeProfileBtn').onclick=()=> {
  document.querySelector('#profileModal').classList.add('hidden');
};
document.getElementById('profileInitial').onclick=()=> {
  document.querySelector('#profileModal').classList.remove('hidden');
};
document.getElementById('profileName').onclick=()=> {
  document.querySelector('#profileModal').classList.remove('hidden');
};
document.getElementById('profileRole').onclick=()=> {
  document.querySelector('#profileModal').classList.remove('hidden');
};

// Вход/регистрация
function handleLogin(e, mode) {
  e.preventDefault();
  const name=mode==='login'?prompt('Введите ваш email','user@example.com').split('@')[0]:prompt('Введите ваше имя','Пользователь');
  if(name) {
    currentUser={ name, role:'Пользователь', isAuth:true };
    updateProfileDisplay();
    document.querySelector('#profileModal').classList.add('hidden');
    alert('Вы вошли как '+name);
  }
}
document.getElementById('logoutButton')?.onclick=()=> {
  currentUser={ name:'Гость', role:'Неавторизован', isAuth:false };
  updateProfileDisplay();
  alert('Вы вышли');
};
// Настройки
document.getElementById('settingsButton').onclick=()=> {
  document.querySelector('#settingsModal').classList.remove('hidden');
};
document.getElementById('closeSettingsBtn').onclick=()=> {
  document.querySelector('#settingsModal').classList.add('hidden');
};
document.querySelectorAll('.theme-btn').forEach(btn => {
  btn.onclick=()=> {
    const theme=btn.dataset.theme;
    applyTheme(theme);
  };
});

// Выйти
document.getElementById('logoutBtn')?.addEventListener('click',()=> {
  currentUser={ name:'Гость', role:'Неавторизован', isAuth:false };
  updateProfileDisplay();
  document.querySelector('#settingsModal').classList.add('hidden');
  alert('Вы вышли');
});

// Тема
document.getElementById('themeSwitch').onclick=()=> {
  const t=localStorage.getItem('theme')||'auto';
  if (t==='light') { localStorage.setItem('theme','dark'); }
  else if (t==='dark') { localStorage.setItem('theme','auto'); }
  else { localStorage.setItem('theme','light'); }
  applyTheme(localStorage.getItem('theme'));
};

// Поиск
document.getElementById('searchInput').oninput=()=> {
  const q=document.getElementById('searchInput').value.toLowerCase().trim();
  const results=document.getElementById('searchResults');
  results.innerHTML='';
  if (q.length<2) {
    results.innerHTML='<p class="text-center text-gray-500">Введите запрос</p>';
    return;
  }
  for (let c of chats) {
    if (c.title.toLowerCase().includes(q)) {
      const div=document.createElement('div');
      div.className='p-2 border-b cursor-pointer hover:bg-gray-700';
      div.innerHTML=`<strong>${c.title}</strong><br/><small class="text-gray-400">${c.date}</small>`;
      div.onclick=()=> {
        selectChat(c.id);
        document.querySelector('#searchTab').classList.add('hidden');
        document.querySelector('#chatTab').classList.remove('hidden');
      };
      results.appendChild(div);
    }
  }
};

// Показать/скрыть
function scrollBottom() {
  document.getElementById('messagesContainer').scrollTop=9999;
}
function showTyping() {
  document.getElementById('typingIndicator').classList.remove('hidden');
}
function hideTyping() {
  document.getElementById('typingIndicator').classList.add('hidden');
}

// =================== запуск ====================
init();

</script>

</body>
</html>
