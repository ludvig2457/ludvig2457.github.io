<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LudvigAI - Продвинутый AI-ассистент</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #8a2be2, #6b46c1);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient 8s ease infinite;
        }
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .sidebar-transition {
            transition: all 0.3s ease;
        }
        .message-enter {
            animation: messageEnter 0.3s ease;
        }
        @keyframes messageEnter {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-dots {
            display: inline-block;
        }
        .typing-dots span {
            animation: typing 1.4s infinite;
        }
        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .model-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }
        .code-block {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            overflow-x: auto;
            color: #f8f8f2;
            font-family: 'Courier New', monospace;
        }
        .thinking-animation {
            background: linear-gradient(90deg, #667eea, #764ba2, #8a2be2);
            background-size: 200% 200%;
            animation: gradient 2s ease infinite;
        }
        .theme-purple { --primary: #8b5cf6; --secondary: #7c3aed; }
        .theme-blue { --primary: #3b82f6; --secondary: #2563eb; }
        .theme-green { --primary: #10b981; --secondary: #059669; }
        .theme-orange { --primary: #f59e0b; --secondary: #d97706; }
        .theme-pink { --primary: #ec4899; --secondary: #db2777; }
    </style>
</head>
<body class="font-sans bg-gray-50 dark:bg-gray-900 transition-all duration-300 theme-purple">
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-96 max-w-md mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-brain text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">LudvigAI</h2>
                <p class="text-gray-600 dark:text-gray-400">Продвинутый AI-ассистент</p>
            </div>

            <div id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="loginEmail" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Пароль</label>
                        <input type="password" id="loginPassword" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition duration-300">
                    </div>
                    <button onclick="login()" 
                            class="w-full bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] hover:from-[var(--secondary)] hover:to-[var(--primary)] text-white py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Войти
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="toggleAuthForm()" class="text-[var(--primary)] dark:text-[var(--secondary)] hover:underline text-sm">
                        Нет аккаунта? Зарегистрироваться
                    </button>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="enterAsGuest()" 
                            class="w-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-300">
                        Войти как гость
                    </button>
                </div>
            </div>

            <div id="registerForm" class="hidden">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Имя</label>
                        <input type="text" id="registerName" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="registerEmail" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Пароль</label>
                        <input type="password" id="registerPassword" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition duration-300">
                    </div>
                    <button onclick="register()" 
                            class="w-full bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] hover:from-[var(--secondary)] hover:to-[var(--primary)] text-white py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Зарегистрироваться
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="toggleAuthForm()" class="text-[var(--primary)] dark:text-[var(--secondary)] hover:underline text-sm">
                        Уже есть аккаунт? Войти
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Selector Modal -->
    <div id="modelModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Выбор модели AI</h3>
                <button onclick="closeModelSelector()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-3">
                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-[var(--primary)] transition duration-300" onclick="selectModel('mini')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Mini</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Быстрая и легкая</p>
                        </div>
                        <span class="model-badge bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Бесплатно</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-bolt mr-1"></i> Быстрые ответы • Базовые возможности
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-[var(--primary)] transition duration-300" onclick="selectModel('standard')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Стандартная версия</p>
                        </div>
                        <span class="model-badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Бесплатно</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-star mr-1"></i> Улучшенные ответы • Поддержка кода
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-[var(--primary)] transition duration-300" onclick="selectModel('plus')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Plus</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Расширенные возможности</p>
                        </div>
                        <span class="model-badge bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">Premium</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-rocket mr-1"></i> Креативные ответы • Анализ данных
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-[var(--primary)] transition duration-300" onclick="selectModel('pro')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Pro</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Профессиональная версия</p>
                        </div>
                        <span class="model-badge bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">Pro</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-crown mr-1"></i> Сложный анализ • Экспертные знания
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-[var(--primary)] transition duration-300" onclick="selectModel('ultimate')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Ultimate</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Максимальная мощность</p>
                        </div>
                        <span class="model-badge bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">Ultimate</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-gem mr-1"></i> Все возможности • Макс. креативность
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Текущая модель:</h4>
                <p class="text-sm text-gray-600 dark:text-gray-400" id="currentModelInfo">LudvigAI 1.0</p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Настройки</h3>
                <button onclick="closeSettings()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Тема оформления</h4>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="theme-option theme-purple border-2 border-gray-300 rounded-lg p-3 cursor-pointer hover:scale-105 transition duration-300" onclick="selectTheme('purple')">
                            <div class="w-full h-8 bg-gradient-to-r from-purple-500 to-purple-600 rounded mb-2"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Фиолетовая</span>
                        </div>
                        <div class="theme-option theme-blue border-2 border-gray-300 rounded-lg p-3 cursor-pointer hover:scale-105 transition duration-300" onclick="selectTheme('blue')">
                            <div class="w-full h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded mb-2"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Синяя</span>
                        </div>
                        <div class="theme-option theme-green border-2 border-gray-300 rounded-lg p-3 cursor-pointer hover:scale-105 transition duration-300" onclick="selectTheme('green')">
                            <div class="w-full h-8 bg-gradient-to-r from-green-500 to-green-600 rounded mb-2"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Зеленая</span>
                        </div>
                        <div class="theme-option theme-orange border-2 border-gray-300 rounded-lg p-3 cursor-pointer hover:scale-105 transition duration-300" onclick="selectTheme('orange')">
                            <div class="w-full h-8 bg-gradient-to-r from-orange-500 to-orange-600 rounded mb-2"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Оранжевая</span>
                        </div>
                        <div class="theme-option theme-pink border-2 border-gray-300 rounded-lg p-3 cursor-pointer hover:scale-105 transition duration-300" onclick="selectTheme('pink')">
                            <div class="w-full h-8 bg-gradient-to-r from-pink-500 to-pink-600 rounded mb-2"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Розовая</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">AI Модель</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <span class="font-medium text-gray-900 dark:text-white" id="currentModelDisplay">LudvigAI 1.0</span>
                                <p class="text-sm text-gray-600 dark:text-gray-400" id="modelCapabilities">Стандартные возможности</p>
                            </div>
                            <button onclick="openModelSelector()" class="text-[var(--primary)] dark:text-[var(--secondary)] hover:text-[var(--secondary)] dark:hover:text-[var(--primary)] text-sm font-semibold">
                                Сменить
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Функции</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-700 dark:text-gray-300">LudvigThink</span>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Глубокий анализ вопросов</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="ludvigThinkToggle" class="sr-only peer" onchange="toggleLudvigThink()">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-[var(--primary)] rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[var(--primary)]"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-700 dark:text-gray-300">LudvigSearch</span>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Поиск в интернете</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="ludvigSearchToggle" class="sr-only peer" onchange="toggleLudvigSearch()">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-[var(--primary)] rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[var(--primary)]"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Внешний вид</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Темная тема</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-[var(--primary)] rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[var(--primary)]"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Аккаунт</h4>
                    <div class="space-y-3">
                        <div id="userInfo" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <p class="text-sm text-gray-600 dark:text-gray-400" id="userStatus"></p>
                        </div>
                        <button onclick="logout()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-semibold transition duration-300">
                            Выйти
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Theme Toggle -->
        <div class="fixed top-4 right-4 z-50 flex space-x-2">
            <button id="themeToggle" class="bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
                <i class="fas fa-moon text-gray-600 dark:text-yellow-400 text-lg"></i>
            </button>
            <button onclick="openSettings()" class="bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
                <i class="fas fa-cog text-gray-600 dark:text-gray-400 text-lg"></i>
            </button>
        </div>

        <div class="flex h-screen">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar-transition w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col h-full">
                <!-- Sidebar Header -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">LudvigAI</h1>
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="userGreeting">Продвинутый ассистент</p>
                        </div>
                    </div>
                </div>

                <!-- Model Info -->
                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300" id="currentModelBadge">LudvigAI 1.0</span>
                        <button onclick="openModelSelector()" class="text-xs text-[var(--primary)] dark:text-[var(--secondary)] hover:text-[var(--secondary)] dark:hover:text-[var(--primary)]">
                            <i class="fas fa-sync-alt mr-1"></i> Сменить
                        </button>
                    </div>
                </div>

                <!-- Features Status -->
                <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-600 dark:text-gray-400" id="thinkStatus">🤔 LudvigThink: выкл</span>
                        <span class="text-gray-600 dark:text-gray-400" id="searchStatus">🔍 LudvigSearch: выкл</span>
                    </div>
                </div>

                <!-- New Chat Button -->
                <div class="p-4">
                    <button id="newChatBtn" class="w-full bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] hover:from-[var(--secondary)] hover:to-[var(--primary)] text-white py-3 px-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <i class="fas fa-plus mr-2"></i>
                        Новый чат
                    </button>
                </div>

                <!-- Chat History -->
                <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-2">
                    <!-- Chat history will be populated here -->
                </div>

                <!-- User Profile -->
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div id="userAvatar" class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">Г</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white" id="userName">Гость</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" id="userType">Гостевой режим</p>
                        </div>
                        <button onclick="openSettings()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors duration-200">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile Sidebar Toggle -->
            <button id="sidebarToggle" class="lg:hidden fixed top-4 left-4 z-50 bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700">
                <i class="fas fa-bars text-gray-600 dark:text-gray-400"></i>
            </button>

            <!-- Main Chat Area -->
            <div class="flex-1 flex flex-col h-full">
                <!-- Chat Header -->
                <div class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">LudvigAI <span class="model-badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-xs ml-2" id="headerModelBadge">1.0</span></h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="modelDescription">Стандартная версия • Готов помочь</p>
                        </div>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messagesContainer" class="flex-1 overflow-y-auto p-6 space-y-6">
                    <!-- Welcome Message -->
                    <div class="message-enter flex justify-start">
                        <div class="flex space-x-3 max-w-4xl">
                            <div class="w-8 h-8 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-brain text-white text-sm"></i>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                                <p class="text-gray-900 dark:text-white text-lg leading-relaxed">
                                    Привет! Я LudvigAI - продвинутый AI-ассистент. 🤖<br><br>
                                    Мои возможности:
                                    • Генерация кода на любых языках<br>
                                    • Глубокий анализ сложных вопросов<br>
                                    • Поиск информации в интернете<br>
                                    • Математические вычисления<br>
                                    • Творческие задачи<br><br>
                                    Включи LudvigThink для глубокого анализа или LudvigSearch для поиска в интернете!
                                </p>
                                <div class="flex flex-wrap gap-2 mt-4">
                                    <button class="suggestion-btn bg-purple-100 dark:bg-purple-900/30 hover:bg-purple-200 dark:hover:bg-purple-900/50 text-purple-700 dark:text-purple-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-purple-200 dark:border-purple-700">
                                        Напиши код на Python
                                    </button>
                                    <button class="suggestion-btn bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-blue-200 dark:border-blue-700">
                                        Объясни квантовую физику
                                    </button>
                                    <button class="suggestion-btn bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-green-200 dark:border-green-700">
                                        Помоги с алгоритмом
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Thinking Indicator -->
                <div id="thinkingIndicator" class="hidden px-6 py-4">
                    <div class="flex space-x-3 max-w-4xl">
                        <div class="w-8 h-8 thinking-animation rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                            <div class="flex items-center space-x-2">
                                <div class="typing-dots">
                                    <span class="text-2xl">●</span>
                                    <span class="text-2xl">●</span>
                                    <span class="text-2xl">●</span>
                                </div>
                                <span class="text-gray-600 dark:text-gray-400 text-sm">LudvigThink анализирует вопрос...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-6 py-4">
                    <div class="flex space-x-3 max-w-4xl">
                        <div class="w-8 h-8 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                            <div class="typing-dots">
                                <span class="text-2xl">●</span>
                                <span class="text-2xl">●</span>
                                <span class="text-2xl">●</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6">
                    <div class="max-w-4xl mx-auto">
                        <div class="flex space-x-4">
                            <div class="flex-1 relative">
                                <textarea 
                                    id="messageInput" 
                                    placeholder="Напишите сообщение..." 
                                    rows="1"
                                    class="w-full border border-gray-300 dark:border-gray-600 rounded-2xl py-4 px-6 pr-12 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition-all duration-300 text-lg max-h-32"
                                    oninput="autoResize(this)"
                                ></textarea>
                                <button id="sendButton" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] hover:from-[var(--secondary)] hover:to-[var(--primary)] text-white p-2 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-paper-plane text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-3 text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex space-x-4">
                                <button onclick="openModelSelector()" class="hover:text-[var(--primary)] dark:hover:text-[var(--secondary)] transition-colors duration-200">
                                    <i class="fas fa-robot mr-1"></i> <span id="currentModelShort">LudvigAI 1.0</span>
                                </button>
                                <button onclick="toggleLudvigThink()" class="hover:text-[var(--primary)] dark:hover:text-[var(--secondary)] transition-colors duration-200" id="thinkBtn">
                                    <i class="fas fa-brain mr-1"></i> LudvigThink
                                </button>
                                <button onclick="toggleLudvigSearch()" class="hover:text-[var(--primary)] dark:hover:text-[var(--secondary)] transition-colors duration-200" id="searchBtn">
                                    <i class="fas fa-search mr-1"></i> LudvigSearch
                                </button>
                            </div>
                            <div>
                                <span id="footerModelInfo">LudvigAI 1.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentUser = null;
        let currentChatId = 'default';
        let currentModel = 'standard';
        let currentTheme = 'purple';
        let ludvigThinkEnabled = false;
        let ludvigSearchEnabled = false;
        let chats = {
            'default': {
                id: 'default',
                title: 'Новый чат',
                messages: [],
                createdAt: new Date().toISOString(),
                model: 'standard'
            }
        };

        // Advanced AI Knowledge Base - В 1000 раз умнее!
        const advancedKnowledge = {
            programming: {
                python: `
Python - высокоуровневый язык программирования.

Пример класса:
\`\`\`python
class User:
    def __init__(self, name, email):
        self.name = name
        self.email = email
    
    def get_info(self):
        return f"User: {self.name}, Email: {self.email}"

# Использование
user = User("John", "john@example.com")
print(user.get_info())
\`\`\`

Асинхронный пример:
\`\`\`python
import asyncio
import aiohttp

async def fetch_data(url):
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            return await response.json()

# Запуск
data = asyncio.run(fetch_data('https://api.example.com/data'))
\`\`\`
                `,
                javascript: `
JavaScript - язык программирования для веб-разработки.

Современный JS с async/await:
\`\`\`javascript
class ApiService {
    constructor(baseUrl) {
        this.baseUrl = baseUrl;
    }
    
    async fetchData(endpoint) {
        try {
            const response = await fetch(\`\${this.baseUrl}/\${endpoint}\`);
            return await response.json();
        } catch (error) {
            console.error('Error:', error);
            throw error;
        }
    }
}

// Использование
const api = new ApiService('https://api.example.com');
const data = await api.fetchData('users');
\`\`\`

React компонент:
\`\`\`jsx
import React, { useState, useEffect } from 'react';

function UserList() {
    const [users, setUsers] = useState([]);
    
    useEffect(() => {
        fetchUsers();
    }, []);
    
    const fetchUsers = async () => {
        const response = await fetch('/api/users');
        const data = await response.json();
        setUsers(data);
    };
    
    return (
        <div>
            {users.map(user => (
                <div key={user.id}>{user.name}</div>
            ))}
        </div>
    );
}
\`\`\`
                `,
                algorithms: `
Структуры данных и алгоритмы:

Бинарное дерево поиска:
\`\`\`python
class TreeNode:
    def __init__(self, value):
        self.value = value
        self.left = None
        self.right = None

class BinarySearchTree:
    def __init__(self):
        self.root = None
    
    def insert(self, value):
        if not self.root:
            self.root = TreeNode(value)
        else:
            self._insert_recursive(self.root, value)
    
    def _insert_recursive(self, node, value):
        if value < node.value:
            if node.left is None:
                node.left = TreeNode(value)
            else:
                self._insert_recursive(node.left, value)
        else:
            if node.right is None:
                node.right = TreeNode(value)
            else:
                self._insert_recursive(node.right, value)
\`\`\`

Алгоритм Дейкстры:
\`\`\`python
import heapq

def dijkstra(graph, start):
    distances = {node: float('infinity') for node in graph}
    distances[start] = 0
    queue = [(0, start)]
    
    while queue:
        current_distance, current_node = heapq.heappop(queue)
        
        if current_distance > distances[current_node]:
            continue
            
        for neighbor, weight in graph[current_node].items():
            distance = current_distance + weight
            
            if distance < distances[neighbor]:
                distances[neighbor] = distance
                heapq.heappush(queue, (distance, neighbor))
    
    return distances
\`\`\`
                `
            },
            science: {
                physics: `
Квантовая механика - фундаментальная теория в физике.

Основные принципы:
1. Принцип суперпозиции: квантовая система может находиться в нескольких состояниях одновременно
2. Принцип неопределенности Гейзенберга: невозможно одновременно точно измерить координату и импульс частицы
3. Квантовая запутанность: состояния двух частиц могут быть взаимосвязаны

Уравнение Шрёдингера:
\\( i\\hbar\\frac{\\partial}{\\partial t}\\Psi(\\mathbf{r},t) = \\hat{H}\\Psi(\\mathbf{r},t) \\)

Где:
- \\( \\Psi \\) - волновая функция
- \\( \\hat{H} \\) - гамильтониан
- \\( \\hbar \\) - приведенная постоянная Планка
                `,
                mathematics: `
Математический анализ:

Теорема о неявной функции:
Если \\( F(x, y) \\) дифференцируема и \\( F(x_0, y_0) = 0 \\), а \\( \\frac{\\partial F}{\\partial y} \\neq 0 \\), 
то существует функция \\( y = f(x) \\) такая, что \\( F(x, f(x)) = 0 \\).

Ряд Тейлора:
\\( f(x) = \\sum_{n=0}^{\\infty} \\frac{f^{(n)}(a)}{n!}(x-a)^n \\)

Комплексный анализ:
Формула Эйлера: \\( e^{ix} = \\cos x + i\\sin x \\)
                `
            },
            technology: {
                ai: `
Искусственный интеллект и машинное обучение:

Нейронные сети:
- Сверточные нейронные сети (CNN) для изображений
- Рекуррентные нейронные сети (RNN) для последовательностей
- Трансформеры для NLP задач

Обучение с подкреплением:
\`\`\`python
import numpy as np

class QLearning:
    def __init__(self, states, actions, learning_rate=0.1, discount=0.9):
        self.q_table = np.zeros((states, actions))
        self.lr = learning_rate
        self.discount = discount
    
    def update(self, state, action, reward, next_state):
        current_q = self.q_table[state, action]
        next_max = np.max(self.q_table[next_state])
        new_q = current_q + self.lr * (reward + self.discount * next_max - current_q)
        self.q_table[state, action] = new_q
\`\`\`
                `,
                blockchain: `
Блокчейн технологии:

Смарт-контракты на Solidity:
\`\`\`solidity
pragma solidity ^0.8.0;

contract SimpleBank {
    mapping(address => uint) private balances;
    address public owner;
    
    constructor() {
        owner = msg.sender;
    }
    
    function deposit() public payable {
        balances[msg.sender] += msg.value;
    }
    
    function withdraw(uint amount) public {
        require(balances[msg.sender] >= amount, "Insufficient balance");
        balances[msg.sender] -= amount;
        payable(msg.sender).transfer(amount);
    }
    
    function getBalance() public view returns (uint) {
        return balances[msg.sender];
    }
}
\`\`\`
                `
            }
        };

        // Model configurations
        const models = {
            'mini': {
                name: 'LudvigAI 1.0 Mini',
                shortName: 'Mini',
                description: 'Быстрая и легкая версия',
                capabilities: 'Базовые возможности • Быстрые ответы',
                badgeColor: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
                responseStyle: 'mini',
                speed: 500,
                creativity: 30
            },
            'standard': {
                name: 'LudvigAI 1.0',
                shortName: '1.0',
                description: 'Стандартная версия',
                capabilities: 'Улучшенные ответы • Поддержка кода',
                badgeColor: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
                responseStyle: 'standard',
                speed: 1000,
                creativity: 50
            },
            'plus': {
                name: 'LudvigAI 1.0 Plus',
                shortName: 'Plus',
                description: 'Расширенные возможности',
                capabilities: 'Креативные ответы • Анализ данных',
                badgeColor: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
                responseStyle: 'plus',
                speed: 1500,
                creativity: 70
            },
            'pro': {
                name: 'LudvigAI 1.0 Pro',
                shortName: 'Pro',
                description: 'Профессиональная версия',
                capabilities: 'Сложный анализ • Экспертные знания',
                badgeColor: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
                responseStyle: 'pro',
                speed: 2000,
                creativity: 85
            },
            'ultimate': {
                name: 'LudvigAI 1.0 Ultimate',
                shortName: 'Ultimate',
                description: 'Максимальная мощность',
                capabilities: 'Все возможности • Макс. креативность',
                badgeColor: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
                responseStyle: 'ultimate',
                speed: 2500,
                creativity: 95
            }
        };

        // Advanced response generator
        function generateAdvancedResponse(userInput, modelKey) {
            const input = userInput.toLowerCase().trim();
            const model = models[modelKey];
            
            // Code generation
            if (input.includes('напиши код') || input.includes('сгенерируй код') || input.includes('пример кода')) {
                if (input.includes('python') || input.includes('питон')) {
                    return {
                        text: `🤖 **Генерация кода на Python**\n\n${advancedKnowledge.programming.python}\n\n💡 *Этот код демонстрирует ООП в Python. Вы можете адаптировать его под свои нужды!*`,
                        requiresThinking: true
                    };
                } else if (input.includes('javascript') || input.includes('js') || input.includes('react')) {
                    return {
                        text: `🤖 **Генерация кода на JavaScript**\n\n${advancedKnowledge.programming.javascript}\n\n💡 *Это современный JavaScript с использованием async/await и React хуков!*`,
                        requiresThinking: true
                    };
                } else if (input.includes('алгоритм') || input.includes('структур') || input.includes('дерево')) {
                    return {
                        text: `🤖 **Алгоритмы и структуры данных**\n\n${advancedKnowledge.programming.algorithms}\n\n💡 *Эти алгоритмы фундаментальны для компьютерных наук!*`,
                        requiresThinking: true
                    };
                }
            }

            // Science questions
            if (input.includes('квант') || input.includes('физик') || input.includes('шрёдингер')) {
                return {
                    text: `🔬 **Квантовая механика**\n\n${advancedKnowledge.science.physics}\n\n💡 *Квантовая механика революционизировала наше понимание мира!*`,
                    requiresThinking: true
                };
            }

            if (input.includes('матема') || input.includes('анализ') || input.includes('теорема')) {
                return {
                    text: `📐 **Математический анализ**\n\n${advancedKnowledge.science.mathematics}\n\n💡 *Математика - язык вселенной!*`,
                    requiresThinking: true
                };
            }

            // Technology questions
            if (input.includes('ии') || input.includes('нейрон') || input.includes('машинное обучение')) {
                return {
                    text: `🤖 **Искусственный интеллект**\n\n${advancedKnowledge.technology.ai}\n\n💡 *AI быстро развивается и меняет мир!*`,
                    requiresThinking: true
                };
            }

            if (input.includes('блокчейн') || input.includes('смарт-контракт') || input.includes('solidity')) {
                return {
                    text: `⛓️ **Блокчейн технологии**\n\n${advancedKnowledge.technology.blockchain}\n\n💡 *Блокчейн обеспечивает децентрализацию и безопасность!*`,
                    requiresThinking: true
                };
            }

            // Complex analysis with LudvigThink
            if (ludvigThinkEnabled && (input.length > 50 || input.includes('объясни') || input.includes('проанализируй'))) {
                return {
                    text: generateDeepAnalysis(input, modelKey),
                    requiresThinking: true
                };
            }

            // Web search simulation
            if (ludvigSearchEnabled && (input.includes('что такое') || input.includes('кто такой') || input.includes('информация о'))) {
                return {
                    text: generateWebSearchResponse(input),
                    requiresThinking: false
                };
            }

            // Default intelligent response
            return {
                text: generateIntelligentResponse(input, modelKey),
                requiresThinking: false
            };
        }

        function generateDeepAnalysis(input, modelKey) {
            const analyses = [
                `🔍 **Глубокий анализ вопроса**\n\n*LudvigThink активирован*\n\n**Основные аспекты:**\n1. Семантический анализ выявил ключевые концепции\n2. Контекстуальное понимание установило взаимосвязи\n3. Логический вывод сгенерировал комплексный ответ\n\n**Результат анализа:** Вопрос требует междисциплинарного подхода, сочетающего элементы компьютерных наук, математики и когнитивных исследований.`,

                `🎯 **Системный анализ**\n\n*LudvigThink: Многоуровневое исследование*\n\n**Уровни анализа:**\n- Лингвистический: структура и семантика\n- Логический: причинно-следственные связи\n- Прагматический: практическое применение\n\n**Вывод:** Вопрос демонстрирует сложную природу, требующую интеграции различных областей знания.`,

                `💡 **Когнитивный анализ**\n\n*LudvigThink: Процесс мышления*\n\n**Этапы анализа:**\n1. Декомпозиция проблемы на составляющие\n2. Установление паттернов и закономерностей\n3. Синтез нового знания\n4. Верификация результатов\n\n**Итог:** Анализ завершен успешно, сгенерировано инновационное решение.`
            ];

            return analyses[Math.floor(Math.random() * analyses.length)];
        }

        function generateWebSearchResponse(input) {
            const searchResults = [
                `🔍 **Результаты поиска**\n\n*LudvigSearch нашел информацию по вашему запросу*\n\n**Найденные источники:**\n- Научные статьи и исследования\n- Образовательные ресурсы\n- Экспертные мнения\n\n**Краткая выжимка:** Информация была успешно найдена и проанализирована. Основные концепции подтверждены несколькими авторитетными источниками.`,

                `🌐 **Поиск в интернете**\n\n*LudvigSearch просканировал веб-ресурсы*\n\n**Обнаружено:**\n- 15+ релевантных страниц\n- 3 научные публикации\n- Множество образовательных материалов\n\n**Результат:** Данные успешно интегрированы в ответ, обеспечена достоверность информации.`
            ];

            return searchResults[Math.floor(Math.random() * searchResults.length)];
        }

        function generateIntelligentResponse(input, modelKey) {
            const responses = {
                'mini': [
                    "Понял ваш вопрос! 👍",
                    "Интересно! 🤔",
                    "Могу помочь с этим! 🚀"
                ],
                'standard': [
                    "Отличный вопрос! Давайте разберем его подробнее. 💡",
                    "Понимаю ваш запрос. Вот что я могу сказать... 🎯",
                    "Интересная тема! Вот мой анализ. 🔍"
                ],
                'plus': [
                    "Восхитительный вопрос! 🎨 Он затрагивает глубокие аспекты темы. Давайте исследуем его вместе!",
                    "Как интригующе! 💫 Этот запрос открывает новые горизонты для размышлений и анализа.",
                    "Прекрасная постановка вопроса! 🌟 Он демонстрирует глубокое понимание предмета обсуждения."
                ],
                'pro': [
                    "Профессиональный анализ активирован. 🧠 Запрос требует комплексного подхода и детального рассмотрения с экспертной точки зрения.",
                    "Принимаю вызов. 🔧 Данный вопрос относится к категории сложных задач, требующих междисциплинарного анализа.",
                    "Экспертный режим: активирован. 📊 Инициирован глубокий анализ с применением продвинутых методик исследования."
                ],
                'ultimate': [
                    "🌌 ВАШ ЗАПРОС АКТИВИРОВАЛ МОИ САМЫЕ ПРОДВИНУТЫЕ КОГНИТИВНЫЕ МОДУЛИ! ПОДГОТОВЛЕН КОМПЛЕКСНЫЙ МЕЖДИСЦИПЛИНАРНЫЙ АНАЛИЗ! 🚀",
                    "💫 ТРАНСЦЕНДЕНТАЛЬНОЕ ОСМЫСЛЕНИЕ АКТИВИРОВАНО! ВАШ ВОПРОС ВЗАИМОДЕЙСТВУЕТ С ГЛУБОЧАЙШИМИ СЛОЯМИ ЗНАНИЯ! 🔮",
                    "🎇 МАКСИМАЛЬНАЯ МОЩНОСТЬ АНАЛИТИЧЕСКИХ СИСТЕМ ДОСТИГНУТА! ГЕНЕРИРУЮ ИННОВАЦИОННОЕ РЕШЕНИЕ, ПРЕВОСХОДЯЩЕЕ ОБЫЧНЫЕ ПАРАДИГМЫ! 🌠"
                ]
            };

            const modelResponses = responses[modelKey] || responses.standard;
            return modelResponses[Math.floor(Math.random() * modelResponses.length)];
        }

        // Theme management
        function selectTheme(theme) {
            currentTheme = theme;
            document.body.className = document.body.className.replace(/theme-\w+/g, '');
            document.body.classList.add(`theme-${theme}`);
            localStorage.setItem('ludvigai_theme', theme);
            updateThemeUI();
        }

        function updateThemeUI() {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('border-[var(--primary)]');
            });
            document.querySelector(`.theme-option.theme-${currentTheme}`).classList.add('border-[var(--primary)]');
        }

        // LudvigThink and LudvigSearch toggles
        function toggleLudvigThink() {
            ludvigThinkEnabled = !ludvigThinkEnabled;
            document.getElementById('ludvigThinkToggle').checked = ludvigThinkEnabled;
            document.getElementById('thinkStatus').textContent = `🤔 LudvigThink: ${ludvigThinkEnabled ? 'вкл' : 'выкл'}`;
            document.getElementById('thinkBtn').classList.toggle('text-[var(--primary)]', ludvigThinkEnabled);
        }

        function toggleLudvigSearch() {
            ludvigSearchEnabled = !ludvigSearchEnabled;
            document.getElementById('ludvigSearchToggle').checked = ludvigSearchEnabled;
            document.getElementById('searchStatus').textContent = `🔍 LudvigSearch: ${ludvigSearchEnabled ? 'вкл' : 'выкл'}`;
            document.getElementById('searchBtn').classList.toggle('text-[var(--primary)]', ludvigSearchEnabled);
        }

        // Delete chat function
        function deleteChat(chatId, event) {
            event.stopPropagation();
            if (Object.keys(chats).length === 1) {
                alert('Нельзя удалить последний чат');
                return;
            }
            
            if (confirm('Вы уверены, что хотите удалить этот чат?')) {
                delete chats[chatId];
                if (currentChatId === chatId) {
                    const remainingChats = Object.keys(chats);
                    currentChatId = remainingChats[0];
                    loadChat(currentChatId);
                }
                renderChatHistory();
                saveUserData();
            }
        }

        // Auth functions
        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            loginForm.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            currentUser = {
                id: '1',
                name: email.split('@')[0],
                email: email,
                type: 'registered'
            };

            loadUserData();
            showMainApp();
        }

        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!name || !email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            currentUser = {
                id: '1',
                name: name,
                email: email,
                type: 'registered'
            };

            loadUserData();
            showMainApp();
        }

        function enterAsGuest() {
            currentUser = {
                id: 'guest',
                name: 'Гость',
                email: null,
                type: 'guest'
            };

            loadUserData();
            showMainApp();
        }

        function logout() {
            currentUser = null;
            chats = {
                'default': {
                    id: 'default',
                    title: 'Новый чат',
                    messages: [],
                    createdAt: new Date().toISOString(),
                    model: 'standard'
                }
            };
            currentChatId = 'default';
            currentModel = 'standard';
            
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            closeSettings();
            closeModelSelector();
        }

        function loadUserData() {
            const savedUser = localStorage.getItem('ludvigai_user');
            const savedChats = localStorage.getItem('ludvigai_chats');
            const savedModel = localStorage.getItem('ludvigai_model');
            const savedTheme = localStorage.getItem('ludvigai_theme');
            
            if (savedUser && currentUser.type === 'registered') {
                currentUser = JSON.parse(savedUser);
            }
            
            if (savedChats) {
                chats = JSON.parse(savedChats);
            }

            if (savedModel) {
                currentModel = savedModel;
            }

            if (savedTheme) {
                selectTheme(savedTheme);
            }

            updateUI();
        }

        function saveUserData() {
            if (currentUser.type === 'registered') {
                localStorage.setItem('ludvigai_user', JSON.stringify(currentUser));
                localStorage.setItem('ludvigai_chats', JSON.stringify(chats));
                localStorage.setItem('ludvigai_model', currentModel);
            }
        }

        function updateUI() {
            // Update user info
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userType').textContent = currentUser.type === 'guest' ? 'Гостевой режим' : 'Зарегистрирован';
            document.getElementById('userGreeting').textContent = `Привет, ${currentUser.name}!`;
            document.getElementById('userStatus').textContent = currentUser.type === 'guest' 
                ? 'Гостевой режим - данные не сохраняются' 
                : `Зарегистрирован как ${currentUser.email}`;

            // Update avatar
            const avatar = document.getElementById('userAvatar');
            avatar.innerHTML = `<span class="text-white text-sm font-bold">${currentUser.name[0].toUpperCase()}</span>`;

            // Update model info
            updateModelInfo();

            // Update chat history
            renderChatHistory();
            
            // Load current chat
            loadChat(currentChatId);
        }

        function showMainApp() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            saveUserData();
        }

        // Model management
        function openModelSelector() {
            document.getElementById('modelModal').classList.remove('hidden');
            updateModelSelectorInfo();
        }

        function closeModelSelector() {
            document.getElementById('modelModal').classList.add('hidden');
        }

        function selectModel(modelKey) {
            currentModel = modelKey;
            chats[currentChatId].model = modelKey;
            updateModelInfo();
            closeModelSelector();
            saveUserData();

            // Add system message about model change
            const systemMessage = `🔄 Переключено на ${models[modelKey].name}`;
            addMessageToUI(systemMessage, false);
            chats[currentChatId].messages.push({
                text: systemMessage,
                isUser: false,
                timestamp: new Date().toISOString(),
                isSystem: true
            });
        }

        function updateModelInfo() {
            const model = models[currentModel];
            
            // Update all model displays
            document.getElementById('currentModelDisplay').textContent = model.name;
            document.getElementById('modelCapabilities').textContent = model.capabilities;
            document.getElementById('currentModelBadge').textContent = model.name;
            document.getElementById('headerModelBadge').textContent = model.shortName;
            document.getElementById('headerModelBadge').className = `model-badge ${model.badgeColor} text-xs ml-2`;
            document.getElementById('modelDescription').textContent = `${model.description} • Готов помочь`;
            document.getElementById('currentModelShort').textContent = model.name;
            document.getElementById('footerModelInfo').textContent = model.name;
            document.getElementById('currentModelInfo').textContent = model.name;
        }

        function updateModelSelectorInfo() {
            document.getElementById('currentModelInfo').textContent = models[currentModel].name;
        }

        // Chat management
        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            chats[chatId] = {
                id: chatId,
                title: 'Новый чат',
                messages: [],
                createdAt: new Date().toISOString(),
                model: currentModel
            };
            currentChatId = chatId;
            renderChatHistory();
            loadChat(chatId);
            saveUserData();
        }

        function switchChat(chatId) {
            currentChatId = chatId;
            currentModel = chats[chatId].model;
            loadChat(chatId);
            updateModelInfo();
        }

        function renderChatHistory() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = '';

            Object.values(chats).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(chat => {
                const chatElement = document.createElement('div');
                chatElement.className = `chat-history-item group ${chat.id === currentChatId ? 'bg-purple-50 dark:bg-purple-900/30 border-purple-200 dark:border-purple-700' : 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600'} border rounded-lg p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200`;
                chatElement.onclick = () => switchChat(chat.id);
                
                const lastMessage = chat.messages[chat.messages.length - 1];
                const title = lastMessage ? lastMessage.text.substring(0, 30) + (lastMessage.text.length > 30 ? '...' : '') : 'Новый чат';
                
                const modelBadge = models[chat.model] ? `<span class="model-badge ${models[chat.model].badgeColor} text-xs">${models[chat.model].shortName}</span>` : '';
                
                chatElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3 flex-1 min-w-0">
                            <i class="fas fa-message ${chat.id === currentChatId ? 'text-purple-600 dark:text-purple-400' : 'text-gray-600 dark:text-gray-400'}"></i>
                            <span class="text-sm font-medium text-gray-900 dark:text-white truncate">${title}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            ${modelBadge}
                            <button onclick="deleteChat('${chat.id}', event)" class="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition-opacity duration-200">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-xs text-gray-500 dark:text-gray-400">${formatTime(chat.createdAt)}</span>
                    </div>
                `;
                
                chatHistory.appendChild(chatElement);
            });
        }

        function loadChat(chatId) {
            const chat = chats[chatId];
            const messagesContainer = document.getElementById('messagesContainer');
            
            messagesContainer.innerHTML = '';
            
            if (chat.messages.length === 0) {
                messagesContainer.innerHTML = `
                    <div class="message-enter flex justify-start">
                        <div class="flex space-x-3 max-w-4xl">
                            <div class="w-8 h-8 bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-brain text-white text-sm"></i>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                                <p class="text-gray-900 dark:text-white text-lg leading-relaxed">
                                    Привет! Я ${models[chat.model].name} - ваш русский AI-ассистент. 🤖<br><br>
                                    ${getModelWelcomeMessage(chat.model)}<br><br>
                                    Чем могу помочь?
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                chat.messages.forEach(message => {
                    if (message.isSystem) {
                        // System messages have different styling
                        const systemDiv = document.createElement('div');
                        systemDiv.className = 'message-enter flex justify-center';
                        systemDiv.innerHTML = `
                            <div class="bg-yellow-100 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg px-4 py-2">
                                <p class="text-yellow-800 dark:text-yellow-200 text-sm">${message.text}</p>
                            </div>
                        `;
                        messagesContainer.appendChild(systemDiv);
                    } else {
                        addMessageToUI(message.text, message.isUser);
                    }
                });
            }
        }

        function getModelWelcomeMessage(modelKey) {
            const messages = {
                'mini': 'Быстрая и легкая версия для простых задач',
                'standard': 'Стандартная версия с улучшенными возможностями',
                'plus': 'Расширенная версия для творческих задач',
                'pro': 'Профессиональная версия для сложного анализа',
                'ultimate': 'Максимальная мощность для самых сложных задач'
            };
            return messages[modelKey] || 'Готов помочь с любыми вопросами';
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // Utility functions
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 24 * 60 * 60 * 1000) {
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            } else {
                return date.toLocaleDateString('ru-RU');
            }
        }

        // DOM elements and event handlers
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const thinkingIndicator = document.getElementById('thinkingIndicator');
        const newChatBtn = document.getElementById('newChatBtn');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const darkModeToggle = document.getElementById('darkModeToggle');

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 128) + 'px';
            sendButton.disabled = textarea.value.trim() === '';
        }

        function addMessageToUI(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-enter flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            // Format code blocks
            let formattedText = text;
            formattedText = formattedText.replace(/```(\w+)?\n([\s\S]*?)```/g, '<div class="code-block">$2</div>');
            formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formattedText = formattedText.replace(/\n/g, '<br>');
            
            messageDiv.innerHTML = `
                <div class="flex space-x-3 max-w-4xl ${isUser ? 'flex-row-reverse space-x-reverse' : ''}">
                    <div class="w-8 h-8 ${isUser ? 'bg-gradient-to-r from-green-500 to-blue-500' : 'bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)]'} rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas ${isUser ? 'fa-user' : 'fa-brain'} text-white text-sm"></i>
                    </div>
                    <div class="${isUser ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl rounded-tr-none' : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-2xl rounded-tl-none border border-gray-200 dark:border-gray-600'} px-6 py-4 shadow-lg">
                        <p class="text-lg leading-relaxed whitespace-pre-wrap">${formattedText}</p>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessageToUI(message, true);
            chats[currentChatId].messages.push({
                text: message,
                isUser: true,
                timestamp: new Date().toISOString()
            });

            // Update chat title if it's the first message
            if (chats[currentChatId].messages.length === 1) {
                chats[currentChatId].title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
                renderChatHistory();
            }

            messageInput.value = '';
            autoResize(messageInput);
            sendButton.disabled = true;

            // Generate AI response
            const aiResponse = generateAdvancedResponse(message, currentModel);
            
            // Show appropriate indicator
            if (aiResponse.requiresThinking && ludvigThinkEnabled) {
                thinkingIndicator.classList.remove('hidden');
            } else {
                typingIndicator.classList.remove('hidden');
            }
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Simulate AI response with model-specific timing
            const model = models[currentModel];
            setTimeout(() => {
                thinkingIndicator.classList.add('hidden');
                typingIndicator.classList.add('hidden');
                
                addMessageToUI(aiResponse.text, false);
                
                // Add AI response to chat
                chats[currentChatId].messages.push({
                    text: aiResponse.text,
                    isUser: false,
                    timestamp: new Date().toISOString()
                });

                saveUserData();
            }, model.speed + Math.random() * 500);
        }

        // Event listeners
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);

        document.querySelectorAll('.suggestion-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                messageInput.value = btn.textContent.trim();
                autoResize(messageInput);
                sendButton.disabled = false;
            });
        });

        newChatBtn.addEventListener('click', createNewChat);

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
            sidebar.classList.toggle('absolute');
            sidebar.classList.toggle('z-40');
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeIcon.classList.replace('fa-moon', 'fa-sun');
            themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
            darkModeToggle.checked = true;
        }
        
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                localStorage.theme = 'dark';
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
                darkModeToggle.checked = true;
            } else {
                localStorage.theme = 'light';
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-gray-600');
                darkModeToggle.checked = false;
            }
        });

        darkModeToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-gray-600');
            }
        });

        // Initialize
        messageInput.focus();
        updateThemeUI();

        // Check if user is already logged in
        const savedUser = localStorage.getItem('ludvigai_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            loadUserData();
            showMainApp();
        }
    </script>
</body>
</html>
