<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LudvigAI - Ваш русский AI-ассистент</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #8a2be2, #6b46c1);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient 8s ease infinite;
        }
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .sidebar-transition {
            transition: all 0.3s ease;
        }
        .message-enter {
            animation: messageEnter 0.3s ease;
        }
        @keyframes messageEnter {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-dots {
            display: inline-block;
        }
        .typing-dots span {
            animation: typing 1.4s infinite;
        }
        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="font-sans bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-96 max-w-md mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-brain text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">LudvigAI</h2>
                <p class="text-gray-600 dark:text-gray-400">Ваш русский AI-ассистент</p>
            </div>

            <div id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="loginEmail" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Пароль</label>
                        <input type="password" id="loginPassword" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <button onclick="login()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Войти
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="toggleAuthForm()" class="text-purple-600 dark:text-purple-400 hover:underline text-sm">
                        Нет аккаунта? Зарегистрироваться
                    </button>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="enterAsGuest()" 
                            class="w-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-300">
                        Войти как гость
                    </button>
                </div>
            </div>

            <div id="registerForm" class="hidden">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Имя</label>
                        <input type="text" id="registerName" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="registerEmail" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Пароль</label>
                        <input type="password" id="registerPassword" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <button onclick="register()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Зарегистрироваться
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="toggleAuthForm()" class="text-purple-600 dark:text-purple-400 hover:underline text-sm">
                        Уже есть аккаунт? Войти
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Настройки</h3>
                <button onclick="closeSettings()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Внешний вид</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Темная тема</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">AI Настройки</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Температура ответов</label>
                            <input type="range" id="temperature" min="0" max="100" value="50" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                                <span>Более точные</span>
                                <span>Более креативные</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Аккаунт</h4>
                    <div class="space-y-3">
                        <div id="userInfo" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <p class="text-sm text-gray-600 dark:text-gray-400" id="userStatus"></p>
                        </div>
                        <button onclick="logout()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-semibold transition duration-300">
                            Выйти
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Theme Toggle -->
        <div class="fixed top-4 right-4 z-50">
            <button id="themeToggle" class="bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
                <i class="fas fa-moon text-gray-600 dark:text-yellow-400 text-lg"></i>
            </button>
        </div>

        <div class="flex h-screen">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar-transition w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col h-full">
                <!-- Sidebar Header -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">LudvigAI</h1>
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="userGreeting">Ваш русский ассистент</p>
                        </div>
                    </div>
                </div>

                <!-- New Chat Button -->
                <div class="p-4">
                    <button id="newChatBtn" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <i class="fas fa-plus mr-2"></i>
                        Новый чат
                    </button>
                </div>

                <!-- Chat History -->
                <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-2">
                    <!-- Chat history will be populated here -->
                </div>

                <!-- User Profile -->
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div id="userAvatar" class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">Г</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white" id="userName">Гость</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" id="userType">Гостевой режим</p>
                        </div>
                        <button onclick="openSettings()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors duration-200">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile Sidebar Toggle -->
            <button id="sidebarToggle" class="lg:hidden fixed top-4 left-4 z-50 bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700">
                <i class="fas fa-bars text-gray-600 dark:text-gray-400"></i>
            </button>

            <!-- Main Chat Area -->
            <div class="flex-1 flex flex-col h-full">
                <!-- Chat Header -->
                <div class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">LudvigAI</h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Готов помочь с любыми вопросами</p>
                        </div>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messagesContainer" class="flex-1 overflow-y-auto p-6 space-y-6">
                    <!-- Welcome Message -->
                    <div class="message-enter flex justify-start">
                        <div class="flex space-x-3 max-w-4xl">
                            <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-brain text-white text-sm"></i>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                                <p class="text-gray-900 dark:text-white text-lg leading-relaxed">
                                    Привет! Я LudvigAI - ваш русский AI-ассистент. 🤖<br><br>
                                    Я могу помочь вам с:
                                    • Ответами на вопросы<br>
                                    • Программированием<br>
                                    • Творческими задачами<br>
                                    • И многим другим!<br><br>
                                    Чем могу помочь?
                                </p>
                                <div class="flex flex-wrap gap-2 mt-4">
                                    <button class="suggestion-btn bg-purple-100 dark:bg-purple-900/30 hover:bg-purple-200 dark:hover:bg-purple-900/50 text-purple-700 dark:text-purple-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-purple-200 dark:border-purple-700">
                                        Расскажи о себе
                                    </button>
                                    <button class="suggestion-btn bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-blue-200 dark:border-blue-700">
                                        Помоги с кодом
                                    </button>
                                    <button class="suggestion-btn bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-green-200 dark:border-green-700">
                                        Что нового?
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-6 py-4">
                    <div class="flex space-x-3 max-w-4xl">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                            <div class="typing-dots">
                                <span class="text-2xl">●</span>
                                <span class="text-2xl">●</span>
                                <span class="text-2xl">●</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6">
                    <div class="max-w-4xl mx-auto">
                        <div class="flex space-x-4">
                            <div class="flex-1 relative">
                                <textarea 
                                    id="messageInput" 
                                    placeholder="Напишите сообщение..." 
                                    rows="1"
                                    class="w-full border border-gray-300 dark:border-gray-600 rounded-2xl py-4 px-6 pr-12 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 text-lg max-h-32"
                                    oninput="autoResize(this)"
                                ></textarea>
                                <button id="sendButton" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white p-2 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-paper-plane text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-3 text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex space-x-4">
                                <button class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                                    <i class="fas fa-robot mr-1"></i> AI
                                </button>
                                <button class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                                    <i class="fas fa-wand-magic-sparkles mr-1"></i> Креатив
                                </button>
                            </div>
                            <div>
                                <span>LudvigAI v1.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentUser = null;
        let currentChatId = 'default';
        let chats = {
            'default': {
                id: 'default',
                title: 'Новый чат',
                messages: [],
                createdAt: new Date().toISOString()
            }
        };

        // База знаний нейросети LudvigAI
        const responseTemplates = {
            'привет': [
                "Привет! Как твои дела? 😊",
                "Здравствуй! Рад тебя видеть! 👋", 
                "Привет друг! Что нового? 🎉",
                "Хай! Как настроение? 😄",
                "Добрый день! Как поживаешь? 🌟"
            ],
            'как': [
                "У меня все отлично, спасибо! А у тебя? 🤖",
                "Все хорошо, работаю как обычно. 💻",
                "Прекрасно! Спасибо что спросил! ✨",
                "Нормально, ни на что не жалуюсь. Как ты? 😊"
            ],
            'дела': [
                "Дела идут хорошо! Спасибо! 🚀",
                "Все отлично, благодарю! 👍",
                "Работаю, учусь, развиваюсь. 📚",
                "Как всегда - в порядке! 💪"
            ],
            'что': [
                "Ничего особенного, все по старому. 📅",
                "Работаю над интересными проектами! 💡",
                "В последнее время много учусь. 🎓",
                "Все как обычно, спасибо что интересуешься! 🤗"
            ],
            'нового': [
                "Ничего нового, все стабильно. ⚡",
                "Планирую новые проекты! 🎯",
                "Осваиваю новые технологии. 🔧",
                "Все по плану, работа кипит. 🔥"
            ],
            'помоги': [
                "Конечно! Расскажи, чем могу помочь? ❓",
                "С удовольствием! В чем проблема? 💭",
                "Конечно помогу! Что случилось? 🛠️",
                "Я к твоим услугам! Чем помочь? 🤝"
            ],
            'пока': [
                "До свидания! Удачи тебе! 👋",
                "Пока! Хорошего дня! 🌞",
                "Был рад общению! Возвращайся! 🤗",
                "До встречи! Всего наилучшего! ✨"
            ],
            'спасибо': [
                "Пожалуйста! Обращайся еще! 😊",
                "Не за что! Всегда рад помочь! 👍",
                "Пожалуйста! Рад был помочь! 🤝",
                "Не стоит благодарности! 💫"
            ],
            'до': [
                "До свидания! Хорошего дня! 🌟",
                "Пока! Удачи во всем! 🍀",
                "Было приятно пообщаться! Возвращайся! 👋"
            ],
            'свидания': [
                "До свидания! Всего доброго! ✨",
                "Пока! Хорошего настроения! 😊",
                "До встречи! Береги себя! 💖"
            ],
            'расскажи': [
                "Я - LudvigAI, русскоязычный AI-ассистент созданный для помощи в различных задачах! 🤖\n\nМои возможности:\n• Отвечать на вопросы\n• Помогать с программированием\n• Обсуждать технологии\n• Поддерживать беседу\n• И многое другое!",
                "Я искусственный интеллект, созданный чтобы помогать пользователям. Могу отвечать на вопросы, помогать с кодом, обсуждать технологии и просто общаться! 💻",
                "Я ваш виртуальный помощник LudvigAI! Создан для того, чтобы сделать вашу жизнь проще через технологии и общение. Что именно хочешь узнать? 🎯"
            ],
            'код': [
                "Конечно! С каким языком программирования нужна помощь? 🐍\n\nPython, JavaScript, C++ или может что-то другое?",
                "Помогу с кодом! Расскажи подробнее что нужно сделать? 💻",
                "Программирование - это моя стихия! В чем именно нужна помощь? 🔧"
            ],
            'python': [
                "Python - отличный выбор! 🐍\n\nВот базовый пример:\n```python\nprint('Привет, мир!')\n\n# Переменные\nname = 'LudvigAI'\nprint(f'Привет от {name}!')\n```\nЧто конкретно интересует?",
                "Python - мой любимый язык! Могу помочь с:\n• Веб-разработкой (Django/Flask)\n• Data Science\n• Автоматизацией\n• И многим другим!",
                "Отличный выбор! Python прекрасен своей читаемостью и мощными библиотеками. С каким проектом помочь? 🚀"
            ]
        };

        const defaultResponses = [
            "Интересно! Расскажи подробнее. 💭",
            "Понятно! Что еще хочешь узнать? ❓",
            "Я тебя слушаю! Продолжай. 👂",
            "Расскажи мне больше об этом! 📖",
            "Это любопытно! Что думаешь по этому поводу? 🤔",
            "Не совсем понял. Можешь объяснить по-другому? 🔄"
        ];

        // Auth functions
        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            loginForm.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            // Simulate login
            currentUser = {
                id: '1',
                name: email.split('@')[0],
                email: email,
                type: 'registered'
            };

            loadUserData();
            showMainApp();
        }

        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!name || !email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            // Simulate registration
            currentUser = {
                id: '1',
                name: name,
                email: email,
                type: 'registered'
            };

            loadUserData();
            showMainApp();
        }

        function enterAsGuest() {
            currentUser = {
                id: 'guest',
                name: 'Гость',
                email: null,
                type: 'guest'
            };

            loadUserData();
            showMainApp();
        }

        function logout() {
            currentUser = null;
            chats = {
                'default': {
                    id: 'default',
                    title: 'Новый чат',
                    messages: [],
                    createdAt: new Date().toISOString()
                }
            };
            currentChatId = 'default';
            
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            closeSettings();
        }

        function loadUserData() {
            // Load user data from localStorage if exists
            const savedUser = localStorage.getItem('ludvigai_user');
            const savedChats = localStorage.getItem('ludvigai_chats');
            
            if (savedUser && currentUser.type === 'registered') {
                currentUser = JSON.parse(savedUser);
            }
            
            if (savedChats) {
                chats = JSON.parse(savedChats);
            }

            updateUI();
        }

        function saveUserData() {
            if (currentUser.type === 'registered') {
                localStorage.setItem('ludvigai_user', JSON.stringify(currentUser));
                localStorage.setItem('ludvigai_chats', JSON.stringify(chats));
            }
        }

        function updateUI() {
            // Update user info
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userType').textContent = currentUser.type === 'guest' ? 'Гостевой режим' : 'Зарегистрирован';
            document.getElementById('userGreeting').textContent = `Привет, ${currentUser.name}!`;
            document.getElementById('userStatus').textContent = currentUser.type === 'guest' 
                ? 'Гостевой режим - данные не сохраняются' 
                : `Зарегистрирован как ${currentUser.email}`;

            // Update avatar
            const avatar = document.getElementById('userAvatar');
            avatar.innerHTML = `<span class="text-white text-sm font-bold">${currentUser.name[0].toUpperCase()}</span>`;

            // Update chat history
            renderChatHistory();
            
            // Load current chat
            loadChat(currentChatId);
        }

        function showMainApp() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            saveUserData();
        }

        // Chat management
        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            chats[chatId] = {
                id: chatId,
                title: 'Новый чат',
                messages: [],
                createdAt: new Date().toISOString()
            };
            currentChatId = chatId;
            renderChatHistory();
            loadChat(chatId);
            saveUserData();
        }

        function switchChat(chatId) {
            currentChatId = chatId;
            loadChat(chatId);
        }

        function renderChatHistory() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = '';

            Object.values(chats).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(chat => {
                const chatElement = document.createElement('div');
                chatElement.className = `chat-history-item ${chat.id === currentChatId ? 'bg-purple-50 dark:bg-purple-900/30 border-purple-200 dark:border-purple-700' : 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600'} border rounded-lg p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200`;
                chatElement.onclick = () => switchChat(chat.id);
                
                const lastMessage = chat.messages[chat.messages.length - 1];
                const title = lastMessage ? lastMessage.text.substring(0, 30) + (lastMessage.text.length > 30 ? '...' : '') : 'Новый чат';
                
                chatElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-message ${chat.id === currentChatId ? 'text-purple-600 dark:text-purple-400' : 'text-gray-600 dark:text-gray-400'}"></i>
                            <span class="text-sm font-medium text-gray-900 dark:text-white truncate">${chat.title}</span>
                        </div>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${formatTime(chat.createdAt)}</span>
                    </div>
                `;
                
                chatHistory.appendChild(chatElement);
            });
        }

        function loadChat(chatId) {
            const chat = chats[chatId];
            const messagesContainer = document.getElementById('messagesContainer');
            
            messagesContainer.innerHTML = '';
            
            if (chat.messages.length === 0) {
                // Show welcome message for empty chat
                messagesContainer.innerHTML = `
                    <div class="message-enter flex justify-start">
                        <div class="flex space-x-3 max-w-4xl">
                            <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-brain text-white text-sm"></i>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                                <p class="text-gray-900 dark:text-white text-lg leading-relaxed">
                                    Привет! Я LudvigAI - ваш русский AI-ассистент. 🤖<br><br>
                                    Чем могу помочь?
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                chat.messages.forEach(message => {
                    addMessageToUI(message.text, message.isUser);
                });
            }
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // Utility functions
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 24 * 60 * 60 * 1000) {
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            } else {
                return date.toLocaleDateString('ru-RU');
            }
        }

        function getAIResponse(userInput) {
            userInput = userInput.toLowerCase().trim();
            
            for (const keyword in responseTemplates) {
                if (userInput.includes(keyword)) {
                    const responses = responseTemplates[keyword];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // DOM elements and event handlers
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const newChatBtn = document.getElementById('newChatBtn');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const darkModeToggle = document.getElementById('darkModeToggle');

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 128) + 'px';
            sendButton.disabled = textarea.value.trim() === '';
        }

        function addMessageToUI(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-enter flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            messageDiv.innerHTML = `
                <div class="flex space-x-3 max-w-4xl ${isUser ? 'flex-row-reverse space-x-reverse' : ''}">
                    <div class="w-8 h-8 ${isUser ? 'bg-gradient-to-r from-green-500 to-blue-500' : 'bg-gradient-to-r from-purple-600 to-blue-600'} rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas ${isUser ? 'fa-user' : 'fa-brain'} text-white text-sm"></i>
                    </div>
                    <div class="${isUser ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl rounded-tr-none' : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-2xl rounded-tl-none border border-gray-200 dark:border-gray-600'} px-6 py-4 shadow-lg">
                        <p class="text-lg leading-relaxed whitespace-pre-wrap">${text}</p>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessageToUI(message, true);
            chats[currentChatId].messages.push({
                text: message,
                isUser: true,
                timestamp: new Date().toISOString()
            });

            // Update chat title if it's the first message
            if (chats[currentChatId].messages.length === 1) {
                chats[currentChatId].title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
                renderChatHistory();
            }

            messageInput.value = '';
            autoResize(messageInput);
            sendButton.disabled = true;

            // Show typing indicator
            typingIndicator.classList.remove('hidden');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Simulate AI response
            setTimeout(() => {
                typingIndicator.classList.add('hidden');
                const aiResponse = getAIResponse(message);
                addMessageToUI(aiResponse, false);
                
                // Add AI response to chat
                chats[currentChatId].messages.push({
                    text: aiResponse,
                    isUser: false,
                    timestamp: new Date().toISOString()
                });

                saveUserData();
            }, 1000 + Math.random() * 1000);
        }

        // Event listeners
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);

        document.querySelectorAll('.suggestion-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                messageInput.value = btn.textContent.trim();
                autoResize(messageInput);
                sendButton.disabled = false;
            });
        });

        newChatBtn.addEventListener('click', createNewChat);

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
            sidebar.classList.toggle('absolute');
            sidebar.classList.toggle('z-40');
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeIcon.classList.replace('fa-moon', 'fa-sun');
            themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
            darkModeToggle.checked = true;
        }
        
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                localStorage.theme = 'dark';
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
                darkModeToggle.checked = true;
            } else {
                localStorage.theme = 'light';
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-gray-600');
                darkModeToggle.checked = false;
            }
        });

        darkModeToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-gray-600');
            }
        });

        // Initialize
        messageInput.focus();

        // Check if user is already logged in
        const savedUser = localStorage.getItem('ludvigai_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            loadUserData();
            showMainApp();
        }
    </script>
</body>
</html>
