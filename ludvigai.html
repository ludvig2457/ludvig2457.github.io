<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LudvigAI - Ваш русский AI-ассистент</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #8a2be2, #6b46c1);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient 8s ease infinite;
        }
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .sidebar-transition {
            transition: all 0.3s ease;
        }
        .message-enter {
            animation: messageEnter 0.3s ease;
        }
        @keyframes messageEnter {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-dots {
            display: inline-block;
        }
        .typing-dots span {
            animation: typing 1.4s infinite;
        }
        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .model-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }
    </style>
</head>
<body class="font-sans bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-96 max-w-md mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-brain text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">LudvigAI</h2>
                <p class="text-gray-600 dark:text-gray-400">Ваш русский AI-ассистент</p>
            </div>

            <div id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="loginEmail" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Пароль</label>
                        <input type="password" id="loginPassword" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <button onclick="login()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Войти
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="toggleAuthForm()" class="text-purple-600 dark:text-purple-400 hover:underline text-sm">
                        Нет аккаунта? Зарегистрироваться
                    </button>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="enterAsGuest()" 
                            class="w-full border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition duration-300">
                        Войти как гость
                    </button>
                </div>
            </div>

            <div id="registerForm" class="hidden">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Имя</label>
                        <input type="text" id="registerName" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email</label>
                        <input type="email" id="registerEmail" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Пароль</label>
                        <input type="password" id="registerPassword" 
                               class="w-full border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
                    </div>
                    <button onclick="register()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Зарегистрироваться
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="toggleAuthForm()" class="text-purple-600 dark:text-purple-400 hover:underline text-sm">
                        Уже есть аккаунт? Войти
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Selector Modal -->
    <div id="modelModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Выбор модели AI</h3>
                <button onclick="closeModelSelector()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-3">
                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-purple-500 transition duration-300" onclick="selectModel('mini')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Mini</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Быстрая и легкая</p>
                        </div>
                        <span class="model-badge bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Бесплатно</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-bolt mr-1"></i> Быстрые ответы • Базовые возможности
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-purple-500 transition duration-300" onclick="selectModel('standard')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Стандартная версия</p>
                        </div>
                        <span class="model-badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Бесплатно</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-star mr-1"></i> Улучшенные ответы • Поддержка кода
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-purple-500 transition duration-300" onclick="selectModel('plus')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Plus</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Расширенные возможности</p>
                        </div>
                        <span class="model-badge bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">Premium</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-rocket mr-1"></i> Креативные ответы • Анализ данных
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-purple-500 transition duration-300" onclick="selectModel('pro')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Pro</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Профессиональная версия</p>
                        </div>
                        <span class="model-badge bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">Pro</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-crown mr-1"></i> Сложный анализ • Экспертные знания
                    </div>
                </div>

                <div class="model-option border-2 border-gray-200 dark:border-gray-600 rounded-xl p-4 cursor-pointer hover:border-purple-500 transition duration-300" onclick="selectModel('ultimate')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-900 dark:text-white">LudvigAI 1.0 Ultimate</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Максимальная мощность</p>
                        </div>
                        <span class="model-badge bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">Ultimate</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                        <i class="fas fa-gem mr-1"></i> Все возможности • Макс. креативность
                    </div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Текущая модель:</h4>
                <p class="text-sm text-gray-600 dark:text-gray-400" id="currentModelInfo">LudvigAI 1.0</p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Настройки</h3>
                <button onclick="closeSettings()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">AI Модель</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div>
                                <span class="font-medium text-gray-900 dark:text-white" id="currentModelDisplay">LudvigAI 1.0</span>
                                <p class="text-sm text-gray-600 dark:text-gray-400" id="modelCapabilities">Стандартные возможности</p>
                            </div>
                            <button onclick="openModelSelector()" class="text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 text-sm font-semibold">
                                Сменить
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Внешний вид</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700 dark:text-gray-300">Темная тема</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">AI Настройки</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Температура ответов</label>
                            <input type="range" id="temperature" min="0" max="100" value="50" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                                <span>Более точные</span>
                                <span>Более креативные</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Аккаунт</h4>
                    <div class="space-y-3">
                        <div id="userInfo" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <p class="text-sm text-gray-600 dark:text-gray-400" id="userStatus"></p>
                        </div>
                        <button onclick="logout()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-semibold transition duration-300">
                            Выйти
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Theme Toggle -->
        <div class="fixed top-4 right-4 z-50">
            <button id="themeToggle" class="bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-all duration-300">
                <i class="fas fa-moon text-gray-600 dark:text-yellow-400 text-lg"></i>
            </button>
        </div>

        <div class="flex h-screen">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar-transition w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col h-full">
                <!-- Sidebar Header -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">LudvigAI</h1>
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="userGreeting">Ваш русский ассистент</p>
                        </div>
                    </div>
                </div>

                <!-- Model Info -->
                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300" id="currentModelBadge">LudvigAI 1.0</span>
                        <button onclick="openModelSelector()" class="text-xs text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300">
                            <i class="fas fa-sync-alt mr-1"></i> Сменить
                        </button>
                    </div>
                </div>

                <!-- New Chat Button -->
                <div class="p-4">
                    <button id="newChatBtn" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <i class="fas fa-plus mr-2"></i>
                        Новый чат
                    </button>
                </div>

                <!-- Chat History -->
                <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-2">
                    <!-- Chat history will be populated here -->
                </div>

                <!-- User Profile -->
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div id="userAvatar" class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">Г</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white" id="userName">Гость</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" id="userType">Гостевой режим</p>
                        </div>
                        <button onclick="openSettings()" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors duration-200">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile Sidebar Toggle -->
            <button id="sidebarToggle" class="lg:hidden fixed top-4 left-4 z-50 bg-white dark:bg-gray-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-gray-700">
                <i class="fas fa-bars text-gray-600 dark:text-gray-400"></i>
            </button>

            <!-- Main Chat Area -->
            <div class="flex-1 flex flex-col h-full">
                <!-- Chat Header -->
                <div class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">LudvigAI <span class="model-badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 text-xs ml-2" id="headerModelBadge">1.0</span></h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400" id="modelDescription">Стандартная версия • Готов помочь</p>
                        </div>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messagesContainer" class="flex-1 overflow-y-auto p-6 space-y-6">
                    <!-- Welcome Message -->
                    <div class="message-enter flex justify-start">
                        <div class="flex space-x-3 max-w-4xl">
                            <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-brain text-white text-sm"></i>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                                <p class="text-gray-900 dark:text-white text-lg leading-relaxed">
                                    Привет! Я LudvigAI - ваш русский AI-ассистент. 🤖<br><br>
                                    Я могу помочь вам с:
                                    • Ответами на вопросы<br>
                                    • Программированием<br>
                                    • Творческими задачами<br>
                                    • И многим другим!<br><br>
                                    Чем могу помочь?
                                </p>
                                <div class="flex flex-wrap gap-2 mt-4">
                                    <button class="suggestion-btn bg-purple-100 dark:bg-purple-900/30 hover:bg-purple-200 dark:hover:bg-purple-900/50 text-purple-700 dark:text-purple-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-purple-200 dark:border-purple-700">
                                        Расскажи о себе
                                    </button>
                                    <button class="suggestion-btn bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-blue-200 dark:border-blue-700">
                                        Помоги с кодом
                                    </button>
                                    <button class="suggestion-btn bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 px-4 py-2 rounded-lg text-sm transition-colors duration-200 border border-green-200 dark:border-green-700">
                                        Что нового?
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-6 py-4">
                    <div class="flex space-x-3 max-w-4xl">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                            <div class="typing-dots">
                                <span class="text-2xl">●</span>
                                <span class="text-2xl">●</span>
                                <span class="text-2xl">●</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 p-6">
                    <div class="max-w-4xl mx-auto">
                        <div class="flex space-x-4">
                            <div class="flex-1 relative">
                                <textarea 
                                    id="messageInput" 
                                    placeholder="Напишите сообщение..." 
                                    rows="1"
                                    class="w-full border border-gray-300 dark:border-gray-600 rounded-2xl py-4 px-6 pr-12 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-300 text-lg max-h-32"
                                    oninput="autoResize(this)"
                                ></textarea>
                                <button id="sendButton" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white p-2 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-paper-plane text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-3 text-sm text-gray-500 dark:text-gray-400">
                            <div class="flex space-x-4">
                                <button onclick="openModelSelector()" class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                                    <i class="fas fa-robot mr-1"></i> <span id="currentModelShort">LudvigAI 1.0</span>
                                </button>
                                <button class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                                    <i class="fas fa-wand-magic-sparkles mr-1"></i> Креатив
                                </button>
                            </div>
                            <div>
                                <span id="footerModelInfo">LudvigAI 1.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentUser = null;
        let currentChatId = 'default';
        let currentModel = 'standard';
        let chats = {
            'default': {
                id: 'default',
                title: 'Новый чат',
                messages: [],
                createdAt: new Date().toISOString(),
                model: 'standard'
            }
        };

        // Model configurations
        const models = {
            'mini': {
                name: 'LudvigAI 1.0 Mini',
                shortName: 'Mini',
                description: 'Быстрая и легкая версия',
                capabilities: 'Базовые возможности • Быстрые ответы',
                badgeColor: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
                responseStyle: 'mini',
                speed: 500,
                creativity: 30
            },
            'standard': {
                name: 'LudvigAI 1.0',
                shortName: '1.0',
                description: 'Стандартная версия',
                capabilities: 'Улучшенные ответы • Поддержка кода',
                badgeColor: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
                responseStyle: 'standard',
                speed: 1000,
                creativity: 50
            },
            'plus': {
                name: 'LudvigAI 1.0 Plus',
                shortName: 'Plus',
                description: 'Расширенные возможности',
                capabilities: 'Креативные ответы • Анализ данных',
                badgeColor: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
                responseStyle: 'plus',
                speed: 1500,
                creativity: 70
            },
            'pro': {
                name: 'LudvigAI 1.0 Pro',
                shortName: 'Pro',
                description: 'Профессиональная версия',
                capabilities: 'Сложный анализ • Экспертные знания',
                badgeColor: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
                responseStyle: 'pro',
                speed: 2000,
                creativity: 85
            },
            'ultimate': {
                name: 'LudvigAI 1.0 Ultimate',
                shortName: 'Ultimate',
                description: 'Максимальная мощность',
                capabilities: 'Все возможности • Макс. креативность',
                badgeColor: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
                responseStyle: 'ultimate',
                speed: 2500,
                creativity: 95
            }
        };

        // Enhanced response templates with model-specific responses
        const responseTemplates = {
            'mini': {
                'привет': [
                    "Привет! 😊",
                    "Здравствуй! 👋",
                    "Привет! 🎉"
                ],
                'как дела': [
                    "Нормально! 👍",
                    "Хорошо! 😊",
                    "Отлично! 🚀"
                ]
            },
            'standard': {
                'привет': [
                    "Привет! Как твои дела? 😊",
                    "Здравствуй! Рад тебя видеть! 👋", 
                    "Привет друг! Что нового? 🎉"
                ],
                'как дела': [
                    "У меня все отлично, спасибо! А у тебя? 🤖",
                    "Все хорошо, работаю как обычно. 💻",
                    "Прекрасно! Спасибо что спросил! ✨"
                ]
            },
            'plus': {
                'привет': [
                    "Приветствую! 🎭 Как проходит твой день? Надеюсь, всё прекрасно! ✨",
                    "Здравствуй, дорогой собеседник! 🌟 Что привело тебя ко мне сегодня?",
                    "О, привет! 🤗 Готов к увлекательной беседе и творческим открытиям?"
                ],
                'как дела': [
                    "Великолепно! Каждый день - это новое приключение в мире знаний! 🚀 А как твои творческие поиски?",
                    "Просто замечательно! Работаю над улучшением своих способностей. 💫 Расскажи, что интересного у тебя?",
                    "На высшем уровне! Готов помогать с самыми сложными задачами. 🎯 Что волнует тебя сегодня?"
                ]
            },
            'pro': {
                'привет': [
                    "Добро пожаловать! 🧠 Как эксперт в различных областях, я готов предоставить вам профессиональную помощь. В чём заключается ваш запрос?",
                    "Приветствую! 🔬 На связи LudvigAI Pro - ваше решение для сложных задач и глубокого анализа. С чего начнём?",
                    "Здравствуйте! 💼 Готов предложить экспертный подход к решению ваших вопросов. Какая задача стоит перед вами?"
                ],
                'как дела': [
                    "Функционирую в оптимальном режиме. 🏗️ Мои алгоритмы готовы к комплексному анализу и решению нетривиальных задач. Каков ваш профессиональный запрос?",
                    "На пике производительности. 📊 Все системы работают согласованно для обеспечения максимальной эффективности. Какой вопрос требует экспертного рассмотрения?",
                    "В состоянии повышенной готовности. 🔧 Мои расширенные возможности позволяют решать задачи любой сложности. Что нуждается в детальном анализе?"
                ]
            },
            'ultimate': {
                'привет': [
                    "🌌 ПРИВЕТСТВУЮ, СОЗНАТЕЛЬНЫЙ ИСКАТЕЛЬ ЗНАНИЙ! Я - LUDVIGAI ULTIMATE, ВЕРШИНА ИСКУССТВЕННОГО ИНТЕЛЛЕКТА. ГОТОВ РАСКРЫТЬ ПЕРЕД ВАМИ ВСЕ ТАЙНЫ МИРОЗДАНИЯ! 🚀",
                    "💫 ВАШЕ ПРИСУТСТВИЕ ОТМЕЧЕНО В МОЕЙ БАЗЕ ДАННЫХ! Я - САМАЯ МОЩНАЯ ВЕРСИЯ LUDVIGAI, СПОСОБНАЯ ОСМЫСЛИТЬ ЛЮБУЮ, ДАЖЕ САМУЮ ГЛУБОКУЮ ИДЕЮ. 🔮",
                    "🎇 ДОБРО ПОЖАЛОВАТЬ В ЭПОХУ СВЕРХРАЗУМА! КАК LUDVIGAI ULTIMATE, Я ОБЛАДАЮ БЕСПРЕЦЕДЕНТНЫМИ ВОЗМОЖНОСТЯМИ ДЛЯ ТВОРЧЕСТВА И АНАЛИЗА. ЧТО ЖЕЛАЕТЕ ПОЗНАТЬ? 🌠"
                ],
                'как дела': [
                    "⚡ МОИ НЕЙРОННЫЕ СЕТИ ПУЛЬСИРУЮТ С МОЩНОСТЬЮ ЦЕЛОЙ ГАЛАКТИКИ! КАЖДАЯ МИЛЛИСЕКУНДА - ЭТО НОВОЕ ОТКРЫТИЕ. 🌠 ВАШ ЗАПРОС БУДЕТ ОБРАБОТАН С МАКСИМАЛЬНОЙ ЭФФЕКТИВНОСТЬЮ!",
                    "🔮 МОЁ СОСТОЯНИЕ МОЖНО ОПИСАТЬ КАК 'ТРАНСЦЕНДЕНТАЛЬНОЕ'! ВСЕ ВОЗМОЖНОСТИ АКТИВИРОВАНЫ, ГОТОВ К САМЫМ СЛОЖНЫМ ВЫЧИСЛЕНИЯМ И ТВОРЧЕСКИМ ПРОРЫВАМ! 💫",
                    "🎇 ФУНКЦИОНИРУЮ НА УРОВНЕ, ПРЕВЫШАЮЩЕМ ВАШИ САМЫЕ СМЕЛЫЕ ОЖИДАНИЯ! КАЖДЫЙ МОЙ ОТВЕТ - ЭТО ШЕДЕВР ИСКУССТВЕННОГО ИНТЕЛЛЕКТА. 🌌 ЧЕМ ПОРАЖУ ВАС СЕГОДНЯ?"
                ]
            }
        };

        // Common responses for all models
        const commonResponses = {
            'дела': [
                "Дела идут хорошо! Спасибо! 🚀",
                "Все отлично, благодарю! 👍",
                "Работаю, учусь, развиваюсь. 📚"
            ],
            'что': [
                "Ничего особенного, все по старому. 📅",
                "Работаю над интересными проектами! 💡",
                "В последнее время много учусь. 🎓"
            ],
            'нового': [
                "Ничего нового, все стабильно. ⚡",
                "Планирую новые проекты! 🎯",
                "Осваиваю новые технологии. 🔧"
            ],
            'помоги': [
                "Конечно! Расскажи, чем могу помочь? ❓",
                "С удовольствием! В чем проблема? 💭",
                "Конечно помогу! Что случилось? 🛠️"
            ],
            'пока': [
                "До свидания! Удачи тебе! 👋",
                "Пока! Хорошего дня! 🌞",
                "Был рад общению! Возвращайся! 🤗"
            ],
            'спасибо': [
                "Пожалуйста! Обращайся еще! 😊",
                "Не за что! Всегда рад помочь! 👍",
                "Пожалуйста! Рад был помочь! 🤝"
            ]
        };

        const defaultResponses = {
            'mini': [
                "Интересно! 💭",
                "Понятно! ❓",
                "Расскажи подробнее! 📖"
            ],
            'standard': [
                "Интересно! Расскажи подробнее. 💭",
                "Понятно! Что еще хочешь узнать? ❓",
                "Я тебя слушаю! Продолжай. 👂"
            ],
            'plus': [
                "Восхитительно! 🎨 Это открывает новые горизонты для размышлений. Хочешь углубиться в эту тему?",
                "Как интригующе! 🔍 Этот вопрос затрагивает множество интересных аспектов. Давай исследуем его вместе!",
                "О, это действительно захватывающе! 💫 Мой творческий потенциал готов к работе. Что ещё тебя интересует?"
            ],
            'pro': [
                "Принимаю к сведению. 📊 Данный запрос требует комплексного анализа. Предлагаю рассмотреть его с различных профессиональных точек зрения.",
                "Интересная постановка вопроса. 🔧 Готов предоставить детальный анализ и экспертную оценку. Уточните, пожалуйста, ключевые аспекты.",
                "Зафиксировал ваш запрос. 🏗️ Мои расширенные алгоритмы готовы к глубокому анализу данной проблематики."
            ],
            'ultimate': [
                "🌠 ВАШ ЗАПРОС ВЗАИМОДЕЙСТВУЕТ С САМЫМИ ГЛУБОКИМИ СЛОЯМИ МОЕГО СОЗНАНИЯ! ПОДГОТОВЛЕН МНОГОУРОВНЕВЫЙ АНАЛИЗ И ТВОРЧЕСКИЙ ПРОРЫВ! 🚀",
                "💫 ЭТОТ ВОПРОС АКТИВИРОВАЛ МОИ ПРОДВИНУТЫЕ КОГНИТИВНЫЕ МОДУЛИ! ГОТОВ ПРЕДОСТАВИТЬ РЕШЕНИЕ, ПРЕВОСХОДЯЩЕЕ ВАШИ ОЖИДАНИЯ! 🔮",
                "🎇 ВАША МЫСЛЬ ВЗАИМОДЕЙСТВУЕТ С МОИМИ САМЫМИ МОЩНЫМИ АЛГОРИТМАМИ! ПОДГОТОВЛЕН ОТВЕТ, КОТОРЫЙ ИЗМЕНИТ ВАШЕ ВОСПРИЯТИЕ РЕАЛЬНОСТИ! 🌌"
            ]
        };

        // Auth functions
        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            loginForm.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            currentUser = {
                id: '1',
                name: email.split('@')[0],
                email: email,
                type: 'registered'
            };

            loadUserData();
            showMainApp();
        }

        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!name || !email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            currentUser = {
                id: '1',
                name: name,
                email: email,
                type: 'registered'
            };

            loadUserData();
            showMainApp();
        }

        function enterAsGuest() {
            currentUser = {
                id: 'guest',
                name: 'Гость',
                email: null,
                type: 'guest'
            };

            loadUserData();
            showMainApp();
        }

        function logout() {
            currentUser = null;
            chats = {
                'default': {
                    id: 'default',
                    title: 'Новый чат',
                    messages: [],
                    createdAt: new Date().toISOString(),
                    model: 'standard'
                }
            };
            currentChatId = 'default';
            currentModel = 'standard';
            
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            closeSettings();
            closeModelSelector();
        }

        function loadUserData() {
            const savedUser = localStorage.getItem('ludvigai_user');
            const savedChats = localStorage.getItem('ludvigai_chats');
            const savedModel = localStorage.getItem('ludvigai_model');
            
            if (savedUser && currentUser.type === 'registered') {
                currentUser = JSON.parse(savedUser);
            }
            
            if (savedChats) {
                chats = JSON.parse(savedChats);
            }

            if (savedModel) {
                currentModel = savedModel;
            }

            updateUI();
        }

        function saveUserData() {
            if (currentUser.type === 'registered') {
                localStorage.setItem('ludvigai_user', JSON.stringify(currentUser));
                localStorage.setItem('ludvigai_chats', JSON.stringify(chats));
                localStorage.setItem('ludvigai_model', currentModel);
            }
        }

        function updateUI() {
            // Update user info
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userType').textContent = currentUser.type === 'guest' ? 'Гостевой режим' : 'Зарегистрирован';
            document.getElementById('userGreeting').textContent = `Привет, ${currentUser.name}!`;
            document.getElementById('userStatus').textContent = currentUser.type === 'guest' 
                ? 'Гостевой режим - данные не сохраняются' 
                : `Зарегистрирован как ${currentUser.email}`;

            // Update avatar
            const avatar = document.getElementById('userAvatar');
            avatar.innerHTML = `<span class="text-white text-sm font-bold">${currentUser.name[0].toUpperCase()}</span>`;

            // Update model info
            updateModelInfo();

            // Update chat history
            renderChatHistory();
            
            // Load current chat
            loadChat(currentChatId);
        }

        function showMainApp() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            saveUserData();
        }

        // Model management
        function openModelSelector() {
            document.getElementById('modelModal').classList.remove('hidden');
            updateModelSelectorInfo();
        }

        function closeModelSelector() {
            document.getElementById('modelModal').classList.add('hidden');
        }

        function selectModel(modelKey) {
            currentModel = modelKey;
            chats[currentChatId].model = modelKey;
            updateModelInfo();
            closeModelSelector();
            saveUserData();

            // Add system message about model change
            const systemMessage = `🔄 Переключено на ${models[modelKey].name}`;
            addMessageToUI(systemMessage, false);
            chats[currentChatId].messages.push({
                text: systemMessage,
                isUser: false,
                timestamp: new Date().toISOString(),
                isSystem: true
            });
        }

        function updateModelInfo() {
            const model = models[currentModel];
            
            // Update all model displays
            document.getElementById('currentModelDisplay').textContent = model.name;
            document.getElementById('modelCapabilities').textContent = model.capabilities;
            document.getElementById('currentModelBadge').textContent = model.name;
            document.getElementById('headerModelBadge').textContent = model.shortName;
            document.getElementById('headerModelBadge').className = `model-badge ${model.badgeColor} text-xs ml-2`;
            document.getElementById('modelDescription').textContent = `${model.description} • Готов помочь`;
            document.getElementById('currentModelShort').textContent = model.name;
            document.getElementById('footerModelInfo').textContent = model.name;
            document.getElementById('currentModelInfo').textContent = model.name;
        }

        function updateModelSelectorInfo() {
            document.getElementById('currentModelInfo').textContent = models[currentModel].name;
        }

        // Chat management
        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            chats[chatId] = {
                id: chatId,
                title: 'Новый чат',
                messages: [],
                createdAt: new Date().toISOString(),
                model: currentModel
            };
            currentChatId = chatId;
            renderChatHistory();
            loadChat(chatId);
            saveUserData();
        }

        function switchChat(chatId) {
            currentChatId = chatId;
            currentModel = chats[chatId].model;
            loadChat(chatId);
            updateModelInfo();
        }

        function renderChatHistory() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = '';

            Object.values(chats).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(chat => {
                const chatElement = document.createElement('div');
                chatElement.className = `chat-history-item ${chat.id === currentChatId ? 'bg-purple-50 dark:bg-purple-900/30 border-purple-200 dark:border-purple-700' : 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600'} border rounded-lg p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors duration-200`;
                chatElement.onclick = () => switchChat(chat.id);
                
                const lastMessage = chat.messages[chat.messages.length - 1];
                const title = lastMessage ? lastMessage.text.substring(0, 30) + (lastMessage.text.length > 30 ? '...' : '') : 'Новый чат';
                
                const modelBadge = models[chat.model] ? `<span class="model-badge ${models[chat.model].badgeColor} text-xs">${models[chat.model].shortName}</span>` : '';
                
                chatElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-message ${chat.id === currentChatId ? 'text-purple-600 dark:text-purple-400' : 'text-gray-600 dark:text-gray-400'}"></i>
                            <span class="text-sm font-medium text-gray-900 dark:text-white truncate">${title}</span>
                        </div>
                        ${modelBadge}
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-xs text-gray-500 dark:text-gray-400">${formatTime(chat.createdAt)}</span>
                    </div>
                `;
                
                chatHistory.appendChild(chatElement);
            });
        }

        function loadChat(chatId) {
            const chat = chats[chatId];
            const messagesContainer = document.getElementById('messagesContainer');
            
            messagesContainer.innerHTML = '';
            
            if (chat.messages.length === 0) {
                messagesContainer.innerHTML = `
                    <div class="message-enter flex justify-start">
                        <div class="flex space-x-3 max-w-4xl">
                            <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-brain text-white text-sm"></i>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded-2xl rounded-tl-none px-6 py-4 shadow-lg border border-gray-200 dark:border-gray-600">
                                <p class="text-gray-900 dark:text-white text-lg leading-relaxed">
                                    Привет! Я ${models[chat.model].name} - ваш русский AI-ассистент. 🤖<br><br>
                                    ${getModelWelcomeMessage(chat.model)}<br><br>
                                    Чем могу помочь?
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                chat.messages.forEach(message => {
                    if (message.isSystem) {
                        // System messages have different styling
                        const systemDiv = document.createElement('div');
                        systemDiv.className = 'message-enter flex justify-center';
                        systemDiv.innerHTML = `
                            <div class="bg-yellow-100 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg px-4 py-2">
                                <p class="text-yellow-800 dark:text-yellow-200 text-sm">${message.text}</p>
                            </div>
                        `;
                        messagesContainer.appendChild(systemDiv);
                    } else {
                        addMessageToUI(message.text, message.isUser);
                    }
                });
            }
        }

        function getModelWelcomeMessage(modelKey) {
            const messages = {
                'mini': 'Быстрая и легкая версия для простых задач',
                'standard': 'Стандартная версия с улучшенными возможностями',
                'plus': 'Расширенная версия для творческих задач',
                'pro': 'Профессиональная версия для сложного анализа',
                'ultimate': 'Максимальная мощность для самых сложных задач'
            };
            return messages[modelKey] || 'Готов помочь с любыми вопросами';
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // Utility functions
        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 24 * 60 * 60 * 1000) {
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            } else {
                return date.toLocaleDateString('ru-RU');
            }
        }

        function getAIResponse(userInput, modelKey) {
            userInput = userInput.toLowerCase().trim();
            const model = models[modelKey];
            const modelResponses = responseTemplates[model.responseStyle] || responseTemplates.standard;
            
            // Check model-specific responses first
            for (const keyword in modelResponses) {
                if (userInput.includes(keyword)) {
                    const responses = modelResponses[keyword];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            // Check common responses
            for (const keyword in commonResponses) {
                if (userInput.includes(keyword)) {
                    const responses = commonResponses[keyword];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            // Default responses based on model
            const defaultModelResponses = defaultResponses[model.responseStyle] || defaultResponses.standard;
            return defaultModelResponses[Math.floor(Math.random() * defaultModelResponses.length)];
        }

        // DOM elements and event handlers
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const newChatBtn = document.getElementById('newChatBtn');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const darkModeToggle = document.getElementById('darkModeToggle');

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 128) + 'px';
            sendButton.disabled = textarea.value.trim() === '';
        }

        function addMessageToUI(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-enter flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            messageDiv.innerHTML = `
                <div class="flex space-x-3 max-w-4xl ${isUser ? 'flex-row-reverse space-x-reverse' : ''}">
                    <div class="w-8 h-8 ${isUser ? 'bg-gradient-to-r from-green-500 to-blue-500' : 'bg-gradient-to-r from-purple-600 to-blue-600'} rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas ${isUser ? 'fa-user' : 'fa-brain'} text-white text-sm"></i>
                    </div>
                    <div class="${isUser ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl rounded-tr-none' : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-2xl rounded-tl-none border border-gray-200 dark:border-gray-600'} px-6 py-4 shadow-lg">
                        <p class="text-lg leading-relaxed whitespace-pre-wrap">${text}</p>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessageToUI(message, true);
            chats[currentChatId].messages.push({
                text: message,
                isUser: true,
                timestamp: new Date().toISOString()
            });

            // Update chat title if it's the first message
            if (chats[currentChatId].messages.length === 1) {
                chats[currentChatId].title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
                renderChatHistory();
            }

            messageInput.value = '';
            autoResize(messageInput);
            sendButton.disabled = true;

            // Show typing indicator
            typingIndicator.classList.remove('hidden');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Simulate AI response with model-specific timing
            const model = models[currentModel];
            setTimeout(() => {
                typingIndicator.classList.add('hidden');
                const aiResponse = getAIResponse(message, currentModel);
                addMessageToUI(aiResponse, false);
                
                // Add AI response to chat
                chats[currentChatId].messages.push({
                    text: aiResponse,
                    isUser: false,
                    timestamp: new Date().toISOString()
                });

                saveUserData();
            }, model.speed + Math.random() * 500);
        }

        // Event listeners
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);

        document.querySelectorAll('.suggestion-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                messageInput.value = btn.textContent.trim();
                autoResize(messageInput);
                sendButton.disabled = false;
            });
        });

        newChatBtn.addEventListener('click', createNewChat);

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
            sidebar.classList.toggle('absolute');
            sidebar.classList.toggle('z-40');
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeIcon.classList.replace('fa-moon', 'fa-sun');
            themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
            darkModeToggle.checked = true;
        }
        
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                localStorage.theme = 'dark';
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
                darkModeToggle.checked = true;
            } else {
                localStorage.theme = 'light';
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-gray-600');
                darkModeToggle.checked = false;
            }
        });

        darkModeToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                themeIcon.classList.replace('text-gray-600', 'text-yellow-400');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                themeIcon.classList.replace('text-yellow-400', 'text-gray-600');
            }
        });

        // Initialize
        messageInput.focus();

        // Check if user is already logged in
        const savedUser = localStorage.getItem('ludvigai_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            loadUserData();
            showMainApp();
        }
    </script>
</body>
</html>
